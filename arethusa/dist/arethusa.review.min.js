/*
 * Arethusa - a backend-independent client-side annotation framework
 * http://github.com/alpheios-project/arethusa
 *
 * Version 0.2.5
 * built from branch widget
 * at 0a82a2ad9cc7468ea781bfa023a1dddbd77130c6
 * on 2020-12-07T15:20:56.224Z
 *
 * Published under the MIT license
 */

"use strict";angular.module("arethusa.review",[]),angular.module("arethusa.review").directive("reviewDiffReport",["review","state",function(a,b){return{restrict:"A",scope:{},compile:function(){return{pre:function(b,c,d){b.rev=a}}},templateUrl:"js/arethusa.review/templates/review_diff_report.html"}}]),angular.module("arethusa.review").directive("reviewElement",["review","morph","state",function(a,b,c){return{restrict:"A",scope:{cat:"=reviewElement",diff:"="},link:function(a,b,d){function e(){var b=a.diff.id;a.wrong=c.getToken(b[0]),a.right=c.getToken(b[1])}function f(){var b=a.diff.label;a.wrong=b[0],a.right=b[1]}function g(){a.errors=[];var b=a.diff.lemma;b&&a.errors.push(b);var c=a.diff.postag;c&&a.errors.push(c)}function h(){"head"===a.cat&&e(),"relation"===a.cat&&f(),"morphology"===a.cat&&g(),a.template="js/arethusa.review/templates/review_element_"+a.cat+".html"}a.$watch("cat",h)},template:'<div ng-include="template"/>'}}]),angular.module("arethusa.review").directive("reviewLinker",["review","translator",function(a,b){return{restrict:"A",scope:{},link:function(c,d,e){function f(a){d.attr("title",c.translations[c.icon]())}c.review=a,c.translations=b({"review.link":"link","review.unlink":"unlink"}),c.$watch("translations",function(a,b){a!==b&&f()},!0),c.$watch("review.link",function(b,d){b?(c.icon="unlink",b!==d&&a.goToCurrentChunk()):c.icon="link",f()})},templateUrl:"js/arethusa.review/templates/review_linker.html"}}]),angular.module("arethusa.review").directive("reviewStats",["review","state",function(a,b){return{restrict:"A",scope:{},link:function(c,d,e){c.rev=a,c.$watch("rev.diffActive",function(d){if(d){c.tokens=a.diffCounts.tokens,c.attrs=a.diffCounts.attrs;var e=arethusaUtil.toPercent(b.totalTokens,c.tokens);c.rgbCode=arethusaUtil.percentToRgb(e,.3)}})},templateUrl:"js/arethusa.review/templates/review_stats.html"}}]),angular.module("arethusa.review").service("review",["configurator","state","$rootScope","navigator","plugins",function(a,b,c,d,e){function f(){this.tokens=0,this.attrs=0}function g(){return r||(r=e.get("morph")),r}function h(){a.getConfAndDelegate(o,["hideMode"]),a.getStickyConf(o,["link","autoDiff"]),o.comparators=["morphology.lemma","morphology.postag","head.id","relation.label"],o.hideMode&&(o.contextMenu=!1,o.autoDiff=!1,o.link=!0);var b=a.getRetrievers(o.conf.retrievers);p=b.TreebankRetriever,o.diffActive=!1}function i(a){angular.forEach(a,function(a,b){var c=a.morphology;c&&(g().postagToAttributes(c),a.style=g().styleOf(c))})}function j(){o.diffActive=!0,c.$broadcast("diffLoaded")}function k(){p.get(function(a){q=a,n(!0)})}function l(a){return arethusaUtil.inject({},a,function(a,b,c){a[b]=arethusaUtil.copySelection(c,o.comparators)})}function m(){var a=o.diffCounts=new f;angular.forEach(o.diff,function(b){a.tokens++,angular.forEach(b,function(b){a.attrs++})})}function n(a){(o.link||a)&&o.goToCurrentChunk(),e.doAfter("depTree",function(){o.autoDiff&&o.compare()})}var o=this;this.name="review";var p,q;this.externalDependencies=["https://cdnjs.cloudflare.com/ajax/libs/jsondiffpatch/0.1.43/jsondiffpatch.min.js"],o.goldTokens={},o.defaultConf={link:!0,contextMenu:!0,contextMenuTemplate:"js/arethusa.review/templates/context_menu.html"};var r;o.goToCurrentChunk=function(){o.pos=d.status.currentPos,o.goldTokens=q[o.pos].tokens,i(o.goldTokens)},this.compare=function(){o.diff=jsondiffpatch.diff(l(b.tokens),l(o.goldTokens)),m(),angular.forEach(o.diff,function(a,c){b.setState(c,"diff",a)}),j()},this.init=function(){h(),q?n():k()}}]),angular.module("arethusa.review").run(["$templateCache",function(a){a.put("js/arethusa.review/templates/context_menu.html",'<div>\n  <div\n    ng-repeat="(cat, diff) in token.diff"\n    review-element="cat"\n    diff="diff">\n  </div>\n  <hr ng-if="token.diff" class="small"/>\n</div>\n'),a.put("js/arethusa.review/templates/review.html",'<div class="small-12 columns" ng-if="!plugin.hideMode">\n  <span>\n    <span class="settings-span-button right" review-linker/>\n    <span>\n      <label class="margined-hor-tiny right"> Auto-compare\n        <input type="checkbox" ng-model="plugin.autoDiff"/>\n      </label>\n    </span>\n  </span>\n</div>\n<div review-stats ng-if="plugin.diffActive"/>\n<div delimiter/>\n<div class="small-12 columns">\n  <div ng-class="{ \'tree-canvas\': !plugin.hideMode }">\n    <div class="tree-settings">\n      <span class="button radius tiny right" ng-click="plugin.compare()">Compare</span>\n    <div>\n    <div\n      ng-if="!plugin.hideMode"\n      dependency-tree\n      tokens="plugin.goldTokens"\n      to-bottom\n      class="full-width">\n    </div>\n  </div>\n</div>\n'),a.put("js/arethusa.review/templates/review_diff_report.html",'<div class="columns" ng-repeat="(id, diff) in rev.diff">\n  <div\n    token="id"\n    colorize="true"\n    click="true"\n    hover="true"\n    highlight="true">\n  </div>\n  <div ng-if="!rev.hideMode">\n    <ul class="no-list">\n      <li ng-repeat="(cat, res) in diff">\n        <div review-element="cat" diff="res"/>\n      </li>\n    </ul>\n  </div>\n</div>\n'),a.put("js/arethusa.review/templates/review_element_head.html",'<div class="text">\n  <span class="review-el-cat">{{ cat }}</span>\n  <span\n    class="error-message-dark"\n    token="wrong"\n    click=true\n    hover=true>\n  </span>\n  <span margin="0 .3rem">↛</span>\n  <span\n    class="success-message-dark"\n    token="right"\n    click=true\n    hover=true>\n  </span>\n</div>\n'),a.put("js/arethusa.review/templates/review_element_morphology.html",'<div class="text">\n  <span class="review-el-cat">{{ cat }}</span>\n  <span ng-switch="errors.length">\n    <span ng-switch-when="1">\n      <span class="error-message-dark">{{ errors[0][0] }}</span>\n      <span margin="0 .3rem">↛</span>\n      <span class="success-message-dark">{{ errors[0][1] }}</span>\n    </span>\n    <span ng-switch-when="2">\n      <span class="error-message-dark">{{ errors[0][0] }}</span>\n      <span margin="0 .3rem">↛</span>\n      <span class="success-message-dark">{{ errors[0][1] }}</span>\n      <br/>\n      <span class="review-el-cat"/>\n      <span class="error-message-dark">{{ errors[1][0] }}</span>\n      <span margin="0 .3rem">↛</span>\n      <span class="success-message-dark">{{ errors[1][1] }}</span>\n    </span>\n  </span>\n</div>\n'),a.put("js/arethusa.review/templates/review_element_relation.html",'<div class="text">\n  <span class="review-el-cat">{{ cat }}</span>\n  <span class="error-message-dark">{{ wrong }}</span>\n  <span margin="0 .3rem">↛</span>\n  <span class="success-message-dark">{{ right }}</span>\n</div>\n'),a.put("js/arethusa.review/templates/review_linker.html",'<span\n  class="clickable flash-on-hover"\n  ng-click="review.link = !review.link">\n  <i class="fa fa-{{ icon }}"></i>\n</span>\n'),a.put("js/arethusa.review/templates/review_stats.html",'<div\n  ng-click="openStats = !openStats"\n  class="small-12 columns text center clickable"\n  style="padding: 0.2rem 0; background-color: {{ rgbCode }}">\n  {{ tokens }} tokens and {{ attrs }} attributes with differences\n</div>\n<div ng-if="openStats" class="small-12 columns fade slide-right">\n  <div delimiter/>\n  <div review-diff-report/>\n</div>\n')}]);
//# sourceMappingURL=arethusa.review.min.map