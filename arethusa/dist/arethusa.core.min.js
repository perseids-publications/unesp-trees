/*
 * Arethusa - a backend-independent client-side annotation framework
 * http://github.com/alpheios-project/arethusa
 *
 * Version 0.2.5
 * built from branch widget
 * at 0a82a2ad9cc7468ea781bfa023a1dddbd77130c6
 * on 2020-12-07T15:20:56.224Z
 *
 * Published under the MIT license
 */

angular.module("arethusa.core",["angulartics","angulartics.google.analytics","arethusa.util","ngResource","ngCookies","ngAnimate","duScroll","pascalprecht.translate","toaster","oc.lazyLoad","gridster","hljs","mm.foundation","LocalStorageModule","angularUUID2","dndLists"]).value("BASE_PATH","..").constant("_",window._),angular.module("arethusa.core").animation(".slider",["$timeout",function(a){function b(b,c){function d(){b.height(g+"px"),g<f&&a(function(){g+=i,d()},h)}var e=500,f=b[0].clientHeight,g=0,h=e/30,i=f/h;d()}function c(a,b){angular.element(a).slideUp(500,b)}return{enter:b,leave:c,addClass:function(a,b,d){"ng-hide"===b&&c(a,d)},removeClass:function(a,c,d){"ng-hide"===c&&b(a,d)}}}]),angular.module("arethusa.core").controller("ArethusaCtrl",["GlobalErrorHandler","$scope","configurator","state","documentStore","notifier","saver","history","plugins","translator","$timeout","globalSettings",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){e.reset(),b.aU=arethusaUtil,b.debug=!1,b.toggleDebugMode=function(){b.debug=!b.debug};var a=c.configurationFor("main");b.state=d,b.plugins=i,b.gS=l,k(function(){f.init(),f.wait(n.loadInProgress()),d.arethusaLoaded=!1,d.init(),g.init(),h.init()}),b.$on("stateLoaded",function(){d.postInit(),d.arethusaLoaded?i.init():b.init()}),b.init=function(){i.start(a.plugins).then(function(){d.arethusaLoaded=!0,f.success(n.loadComplete()),angular.element(document.body)[0].dispatchEvent(new CustomEvent("ArethusaLoaded",{detail:{currentTokenCount:d.totalTokens}})),d.silent=!1})}}var n=j(["loadInProgress","loadComplete"]);b.$on("confLoaded",m)}]),angular.module("arethusa.core").controller("LandingCtrl",["$scope","$window",function(a,b){function c(a,b,c,d){this.name=a,this.caption=b,this.img=f+c,this.url="#/"+d}function d(a,b){this.name=a,this.examples=b}function e(a,b,c){this.name=a,this.img=f+b,this.href=c}a.template="js/templates/landing_page.html";var f="../dist/examples/images/";a.useCases=[new d("Treebanking",[new c("depTrees","","create1.png","example_tb_create?doc=athenaeus12"),new c("review","","tb_review.png","example_tb_review?doc=11&gold=1"),new c("landing.tryYourself","","create2.png","example_tb_create?doc=clean")])],a.partners=[new e("DH Leipzig","dh_logo.png","http://www.dh.uni-leipzig.de"),new e("Perseids","perseids_logo.png","http://sites.tufts.edu/perseids"),new e("Alpheios","alpheios_logo.png","http://www.alpheios.net"),new e("Perseus","perseus_logo.jpg","http://www.perseus.tufts.edu")],a.awards=[new e("ELCH Uni Graz","elch_banner.png","http://elch.uni-graz.at/?page_id=3158")],a.goTo=function(a){b.open(a)}}]),angular.module("arethusa.core").controller("NavigatorCtrl",["$scope","navigator","translator","keyCapture",function(a,b,c,d){function e(a){var b=[],c=[];return b.push(c),a&&angular.forEach(a,function(a,d){var e=aU.last(c);e&&parseInt(e)+1!==parseInt(a)?(c=[a],b.push(c)):c.push(a)}),arethusaUtil.map(b,function(a){if(a.length>1){return a[0]+"-"+a[1]}return a[0]}).join(", ")}a.next=function(){b.nextChunk()},a.prev=function(){b.prevChunk()},a.goToFirst=function(){b.goToFirst()},a.goToLast=function(){b.goToLast()},a.goTo=function(a){b.goTo(a)},a.nav=b,a.$watch("nav.status",function(b,c){a.navStat=b}),a.$watchCollection("navStat.currentIds",function(b,c){b&&(a.ids=e(b))}),a.trsls=c({"navigator.goToNext":"goToNext","navigator.goToPrev":"goToPrev","navigator.goToFirst":"goToFirst","navigator.goToLast":"goToLast",list:"list"}),a.keys={},a.$watch("nav.keys",function(b){b&&(a.keys.nextChunkKey=aU.formatKeyHint(b.navigation.nextChunk),a.keys.prevChunkKey=aU.formatKeyHint(b.navigation.prevChunk),a.keys.listKey=aU.formatKeyHint(b.navigation.list))})}]),angular.module("arethusa.core").controller("SearchCtrl",["$scope","$location","translator",function(a,b,c){a.search=function(){b.search("doc",a.query)},c("search_documents",function(b){a.search_documents=b()})}]),angular.module("arethusa.core").directive("arethusaGrid",["arethusaGrid","plugins","globalSettings","$timeout",function(a,b,c,d){return{restrict:"A",scope:!0,link:function(b,e,f){function g(){c.defineSetting("grid","custom","grid-setting"),c.defineSetting("gridItems","custom","grid-items")}function h(){c.removeSetting("grid"),c.removeSetting("gridItems")}angular.element(document.body).css("overflow","auto"),b.grid=a,d(g),b.$on("$destroy",h)},templateUrl:"js/arethusa.core/templates/arethusa_grid.html"}}]),angular.module("arethusa.core").directive("arethusaGridHandle",["$timeout","plugins",function(a,b){return{restrict:"E",scope:!0,link:function(c,d,e,f,g){function h(){k=a(function(){c.visible=!0},100)}function i(){a.cancel(k)}function j(){c.$apply(function(){c.visible=!1})}var k,l=d.find(".drag-handle-trigger"),m=d.find(".drag-handle");l.bind("mouseenter",h),l.bind("mouseleave",i),m.bind("mouseleave",j),c.$on("pluginsLoaded",function(){c.plugin=b.get(c.item.plugin)}),c.$watch("visible",function(a,b){a||(c.settingsOn=!1)})},templateUrl:"js/arethusa.core/templates/arethusa_grid_handle.html"}}]),angular.module("arethusa.core").directive("arethusaNavbar",["configurator","$window",function(a,b){return{restrict:"AE",scope:!0,link:function(c,d,e){function f(){g(),h()}function g(){c.windowWidth=j.width()}function h(){c.windowWidth;c.logo=i.logo}var i=a.configurationFor("navbar"),j=angular.element(b);f(),j.on("resize",f),c.template=i.template,c.disable=i.disable,c.showSearch=function(){return i.search},c.showNavigation=function(){return i.navigation}},template:'<div ng-if="!disable" ng-include="template"></div>'}}]),angular.module("arethusa.core").directive("arethusaTabs",["plugins","state","arethusaLocalStorage","_",function(a,b,c,d){var e="tabsConfiguration";return{restrict:"A",scope:{tabs:"=arethusaTabs"},link:function(f,g,h){function i(a){a&&(f.list=j(a),x=l(a),s(),t(a),u())}function j(a){return d.map(a,k)}function k(a){return{name:a.name,label:a.displayName}}function l(a){return d.inject(a,function(a,b){return a[b.name]=b,a},{})}function m(a){p(a).active=!0}function n(a){p(a).active=!1}function o(a){return p(a).active}function p(a){var b=y[a.name];return b||(b=y[a.name]={}),b}function q(a,b){angular.element(b.toElement).hide(),f.list.splice(a,1),u()}function r(a){o(a)?n(a):m(a),u(),w()}function s(){f.showSettingsTab=!0}function t(a){d.forEach(a,function(a){angular.isDefined(o(a))||m(a)})}function u(){f.visibleTabs=d.inject(f.list,function(a,b){return o(b)&&a.push(x[b.name]),a},[])}function v(){return c.get(e)||{}}function w(){c.set(e,y)}var x,y=v();f.plugins=a,f.state=b,f.moveTab=q,f.toggleTab=r,f.isActive=o,f.$watch("tabs",i)},templateUrl:"js/arethusa.core/templates/arethusa_tabs.html"}}]),angular.module("arethusa.core").directive("arethusaUser",[function(){return{restrict:"A",scope:{user:"=arethusaUser",withMail:"@"},link:function(a,b,c){function d(){var b="",c=a.user;c.fullName?(b+=c.fullName,c.name&&(b+=" ("+c.name+")")):b+=c.name,a.name=b}d()},templateUrl:"js/arethusa.core/templates/arethusa_user.html"}}]),angular.module("arethusa.core").directive("chunkModeSwitcher",["navigator","notifier","translator",function(a,b,c){var d=10;return{restrict:"A",scope:{},link:function(e,f,g){e.navi=a;var h=c({"navigator.chunkSizeError":"chunkSizeError"});e.$watch("navi.chunkSize",function(a){e.size=a}),e.tryToSetChunkSize=function(){var c=e.size;a.chunkSize!==c&&(c<1||c>d?(b.error(h.chunkSizeError({max:d})),e.size=a.chunkSize):a.changeChunkSize(e.size))}},templateUrl:"js/arethusa.core/templates/chunk_mode_switcher.html"}}]),angular.module("arethusa.core").directive("closeOnEnter",["$document",function(a){return{restrict:"A",link:function(b,c,d){function e(a){13===a.keyCode&&b.$close(!0)}a.on("keyup",e),b.$on("$destroy",function(){a.off("keyup",e)})}}}]),angular.module("arethusa.core").directive("collectedPluginSettings",["plugins",function(a){return{restrict:"A",scope:{},link:function(b,c,d){b.plugins=a},templateUrl:"js/arethusa.core/templates/collected_plugin_settings.html"}}]),angular.module("arethusa.core").directive("colorizerSetting",["globalSettings",function(a){return{restrict:"A",scope:{},link:function(b,c,d){b.gS=a,b.$watch("gS.settings.colorizer",function(a,c){b.setting=a})},templateUrl:"js/arethusa.core/templates/colorizer_setting.html"}}]),angular.module("arethusa.core").directive("debug",function(){return{restrict:"A",link:function(a,b,c){var d;a.$watch(c.debug,function(a,b){d=a}),a.$watch("debug",function(a,c){a?b.show():b.hide()}),a.prettyTokens=function(){return JSON.stringify(d,null,2)}},template:"<pre>{{ prettyTokens() }}</pre>"}}),angular.module("arethusa.core").directive("delimiter",function(){return{restrict:"A",replace:!0,template:'<div class="small-12 columns" style="padding: 0.5rem 0"/>'}}),angular.module("arethusa.core").directive("deselector",["state","translator",function(a,b){return{restrict:"AE",scope:{},link:function(c,d,e){function f(){d.attr("title",g+" "+h)}d.bind("click",function(b){a.deselectAll(),c.$apply()});var g,h;c.$on("keysAdded",function(a,b){var c=b.selections;c&&(h=aU.formatKeyHint(c.deselect),f())}),b("deselectAll",function(a){g=a(),f()})},template:'<i class="fi-unlock"/>'}}]),angular.module("arethusa.core").directive("dynamicDirective",["$compile",function(a){return{restrict:"A",scope:{directive:"@dynamicDirective"},link:function(b,c,d){var e=c[0].tagName.toLowerCase(),f="<"+e+" "+b.directive+"></"+e+">";c.append(a(f)(b.$parent))}}}]),angular.module("arethusa.core").directive("editors",["editors",function(a){return{restrict:"A",scope:{},link:function(b,c,d){b.editors=a},templateUrl:"js/arethusa.core/templates/editors.html"}}]),angular.module("arethusa.core").directive("exit",["exitHandler","translator",function(a,b){return{restrict:"A",scope:{},link:function(c,d,e){a.defined?(d.bind("click",function(b){var c=b.button;a.leave("_self")}),b("exitHandler.exitTo",function(b){d.attr("title",b({title:a.title}))})):d.hide()},template:'<i class="fa fa-sign-out"></i>'}}]),angular.module("arethusa.core").directive("fireEvent",["state",function(a){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,c,d){var e=b.$eval(d.fireEvent),f=b[e.target],g=b[e.property];b.$watch(e.value,function(b,c){c!==b&&a.fireEvent(f,g,c,b)})}]}}]),angular.module("arethusa.core").directive("focusMe",[function(){return{restrict:"A",scope:{focus:"=focusMe"},link:function(a,b,c){a.$watch("focus",function(a,c){a&&b.focus()})}}}]),angular.module("arethusa.core").directive("foreignKeys",["keyCapture","languageSettings","$compile","globalSettings",function(a,b,c,d){return{restrict:"A",scope:{ngChange:"&",ngModel:"@",foreignKeys:"="},link:function(e,f,g){function h(){return(b.getFor("treebank")||b.getFor("hebrewMorph")||{}).lang}function i(){return e.foreignKeys||h()}function j(){return b.langNames[i()]}function k(){var a=j(),b=e.enabled?"enabled":"disabled";return a?a+" input "+b+"!":""}function l(a){e.$broadcast("convertingKey",a.keyCode)}function m(a,b){angular.forEach(b,function(b,d){a.append(c(b)(e))})}function n(){if(j()){var a=f.parent(),b=f.css("margin"),c='<div style="margin: '+b+'"/>';f.css("margin",0),m(a,['<span ng-click="visible = !visible">⌨</span>','            <span              ng-click="enabled = !enabled"              class="settings-span-button">              <i                ng-class="togglerClass()"                class="fa fa-power-off"/>            </span>          ',"<div foreign-keys-help/>"]),a.append(c)}}function o(a,b,c){a.$eval(e.ngModel+" = i + k",{i:b,k:c}),e.ngChange()}e.enabled=!d.disableKeyboardMappings,e.element=f;var p=e.$parent;e.togglerClass=function(){return e.enabled?"success-message-dark":"error-message-dark"},f.attr("placeholder",k),n(),e.parseEvent=function(b,c){var d=f[0].value,g=i();if(g){var h=a.getForeignKey(b,g);return!1===h?(l(b),!1):void 0===h||(l(b),f.value=d+h,c?o(p,d,h):e.$apply(o(p,d,h)),!1)}return!0},e.$watch("enabled",function(a,b){a?f.bind("keydown",e.parseEvent):f.unbind("keydown",e.parseEvent),f.attr("placeholder",k)})}}}]),angular.module("arethusa.core").directive("foreignKeysHelp",["keyCapture","languageSettings","$timeout",function(a,b,c){return{restrict:"AE",scope:!0,link:function(d,e,f){function g(){var c=(b.getFor("treebank")||b.getFor("hebrewMorph")||{}).lang;d.keys=a.mappedKeyboard(c,d.shifted)}function h(){d.$apply(function(){d.shifted=!d.shifted,g()})}function i(a){this.keyCode=a,this.shiftKey=d.shifted}function j(b,c){"shift"===a.codeToKey(b.keyCode)&&d.$apply(function(){d.shifted=c,g()})}var k,l=!1,m=d.$watch("visible",function(a,b){a&&!l&&(k=e.find(".shifter"),k.bind("click",h),m())});d.$watch("shifted",function(a,b){k&&(a?k.addClass("key-hit"):k.removeClass("key-hit"))}),d.$on("convertingKey",function(b,e){if(d.visible){var f=document.getElementById(a.codeToKey(e)),g=angular.element(f);g.addClass("key-hit"),c(function(){g.removeClass("key-hit")},450)}}),d.element.on("keydown",function(a){j(a,!0)}),d.element.on("keyup",function(a){j(a,!1)}),d.generate=function(b){var c=a.keyToCode(b);d.parseEvent(new i(c),!0),d.shifted=!1,g()},g()},templateUrl:"./js/arethusa.core/templates/foreign_keys_help.html"}}]),angular.module("arethusa.core").directive("fullHeight",["$window",function(a){return{restrict:"A",link:function(b,c,d){function e(a){var b=f.height();b>0&&c.height(b-g-h-i)}var f=(angular.element(a),angular.element(document.body)),g=(angular.element(document.getElementById("canvas-border")).height(),c.css("margin-bottom").replace("px","")),h=c.css("padding-bottom").replace("px",""),i=d.fullHeight||0;e()}}}]),angular.module("arethusa.core").directive("globalClickAction",["globalSettings",function(a){return{restrict:"A",scope:{},link:function(b,c,d){b.gS=a,b.setting=a.settings.clickAction},templateUrl:"js/arethusa.core/templates/global_click_action.html"}}]),angular.module("arethusa.core").directive("globalSettingsPanel",["globalSettings","keyCapture","$timeout",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e,f){function g(){d.pluginSettingsVisible=!d.pluginSettingsVisible}d.gS=a,d.kC=b,d.$watch("gS.active",function(a,b){d.active=a,c(function(){a?e.slideDown():e.slideUp()},0,!1)}),d.togglePluginSettings=g},templateUrl:"js/arethusa.core/templates/global_settings_panel.html"}}]),angular.module("arethusa.core").directive("globalSettingsTrigger",["generator","globalSettings","translator","keyCapture",function(a,b,c,d){return a.panelTrigger({service:b,trsl:c,trslKey:"globalSettings.title",template:'<i class="fi-widget"/>',kC:d,mapping:{name:"globalSettings",key:"S"}})}]),angular.module("arethusa.core").directive("gridItems",["arethusaGrid","plugins",function(a,b){return{restrict:"A",scope:{},link:function(c,d,e){c.grid=a,c.plugins=b},templateUrl:"js/arethusa.core/templates/grid_items.html"}}]),angular.module("arethusa.core").directive("gridSetting",["arethusaGrid",function(a){return{restrict:"A",scope:{},link:function(b,c,d){b.grid=a,b.settings=a.settings;var e=["dragging","resizing","floating","pushing"];angular.forEach(e,function(c){b.$watch("settings."+c,function(b,d){b!==d&&a["set"+aU.capitalize(c)](b)})})},templateUrl:"js/arethusa.core/templates/grid_setting.html"}}]),angular.module("arethusa.core").directive("helpPanel",["help","keyCapture","globalSettings","versioner","notifier","$timeout",function(a,b,c,d,e,f){return{restrict:"A",scope:{},link:function(g,h,i){g.help=a,g.kC=b,g.gS=c,g.vers=d,g.notifier=e,g.visible={},g.tools=[{label:"Import/Export your morphological data",hint:"Vla",href:"#/morph_tools"}],g.toggle=function(a){g.visible[a]=!g.visible[a]},g.$watch("help.active",function(a,b){g.active=a,f(function(){a?h.slideDown():(h.slideUp(),g.visible={})})})},templateUrl:"js/arethusa.core/templates/help_panel_widget.html"}}]),angular.module("arethusa.core").directive("helpPanelHeading",[function(){return{restrict:"A",scope:{toggler:"@",heading:"@"},link:function(a,b,c){a.toggle=function(){a.$parent.toggle(a.toggler)}},template:'        <p          class="text underline clickable"          translate="{{ heading }}"          ng-click="toggle()">        </p>      '}}]),angular.module("arethusa.core").directive("helpPanelItem",[function(){return{restrict:"A",scope:!0,transclude:!0,link:function(a,b,c){a.toggler=c.toggler,a.heading=c.heading,a.height=c.height},templateUrl:"js/arethusa.core/templates/help_panel_item.html"}}]),angular.module("arethusa.core").directive("helpTrigger",["generator","help","translator","keyCapture",function(a,b,c,d){return a.panelTrigger({service:b,trsl:c,trslKey:"credits",template:'<i class="fa" translate="credits"></i>'})}]),angular.module("arethusa.core").directive("keyCapture",["keyCapture",function(a){return{restrict:"A",link:function(b,c,d){c.is("body")||(c=angular.element(document).find("body")),c.on("keydown",function(b){a.keydown(b)}),c.on("keyup",function(b){a.keyup(b)})}}}]),angular.module("arethusa.core").directive("keysToScreen",["$timeout","configurator","keyCapture",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e,f){function g(a){this.str="PLUS"===a?"+":a,this.joiner="PLUS"===a}function h(a){d.actions=arethusaUtil.map(c.keyList[a]||[],function(a){return{str:a}});var b,e;return b=(a+"").replace(/-/g,"-PLUS-").split("-"),e=arethusaUtil.inject([],b,function(a,b){b.match(/^[A-Z]$/)?arethusaUtil.pushAll(a,["shift","PLUS",b.toLowerCase()]):a.push(b)}),arethusaUtil.map(e,function(a){return new g(a)})}if(b.configurationFor("main").showKeys){d.keys=[],d.actions=[];var i,j,k;d.$on("keyCaptureLaunched",function(b,c){var e=h(c);d.$apply(function(){k?(d.keys=e,k=!1):arethusaUtil.pushAll(d.keys,e)}),j&&a.cancel(j),i&&a.cancel(i),j=a(function(){k=!0},1500),i=a(function(){d.keys=[],d.actions=[]},3200)})}},templateUrl:"js/arethusa.core/templates/keys_to_screen.html"}}]),angular.module("arethusa.core").directive("langSpecific",["languageSettings",function(a){return{restrict:"A",link:function(b,c,d){var e=a.getFor("treebank")||a.getFor("hebrewMorph");e&&(c.attr("lang",e.lang),c.attr("dir",e.leftToRight?"ltr":"rtl"),c.css("font-family",e.font))}}}]),angular.module("arethusa.core").directive("layoutSetting",["globalSettings",function(a){return{restrict:"A",scope:{},link:function(b,c,d){b.gS=a,b.setting=a.settings.layout},templateUrl:"js/arethusa.core/templates/layout_setting.html"}}]),angular.module("arethusa.core").directive("navbarButtons",["translator",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){b.$watch("windowWidth",function(a,c){var d=a>1150?"":"_collapsed";b.bTemplate="js/arethusa.core/templates/navbar_buttons"+d+".html"}),a("menu",function(a){b.menuTitle=a()})},template:'<ul class="has-form button-group right" ng-include="bTemplate"/>'}}]),angular.module("arethusa.core").directive("navbarNavigation",function(){return{restrict:"A",replace:!0,controller:"NavigatorCtrl",templateUrl:"js/arethusa.core/templates/navbar_navigation.html"}}),angular.module("arethusa.core").directive("navbarNotifier",function(){return{restrict:"A",replace:!0,templateUrl:"js/arethusa.core/templates/navbar_notifier.html"}}),angular.module("arethusa.core").directive("navbarSearch",function(){return{restrict:"A",replace:!0,controller:"SearchCtrl",templateUrl:"js/arethusa.core/templates/navbar_search.html"}}),angular.module("arethusa.core").directive("nextToken",["state",function(a){return{restrict:"AE",link:function(b,c,d){c.bind("click",function(c){b.$apply(a.selectNextToken())})}}}]),angular.module("arethusa.core").directive("notifications",["notifier",function(a){return{restrict:"A",scope:{},link:function(a,b,c){},templateUrl:"js/arethusa.core/templates/notifications.html"}}]),angular.module("arethusa.core").directive("outputter",["$modal","saver","translator",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e,f){d.saver=b,e.bind("click",function(){a.open({templateUrl:"js/arethusa.core/templates/outputter.html",windowClass:"full-modal",scope:d})}),c("saver.previewAndDownload",function(a){e.attr("title",a())})},template:'<i class="fa fa-download"/>'}}]),angular.module("arethusa.core").directive("outputterItem",["fileHandler","$window",function(a,b){return{restrict:"A",link:function(b,c,d){c.addClass("item");var e;b.data=function(){return e||(e=b.obj.output()),e},b.togglePreview=function(){b.preview=!b.preview},b.download=function(){var c=b.obj.identifier+"."+b.obj.fileType,d=b.obj.mimeType;a.download(c,b.data(),d)}},templateUrl:"js/arethusa.core/templates/outputter_item.html"}}]),angular.module("arethusa.core").directive("plugin",["plugins",function(a){return{restrict:"AE",scope:!0,link:function(b,c,d){var e={aT:"artificialToken",SG:"sg"};b.name=e[d.name]||d.name,b.plugin=a.get(b.name),b.withSettings=d.withSettings,b.$on("pluginAdded",function(a,c,d){c===b.name&&(b.plugin=d)})},templateUrl:"js/arethusa.core/templates/plugin.html"}}]),angular.module("arethusa.core").directive("pluginSetting",["userPreferences",function(a){return{restrict:"A",scope:!0,link:function(b,c,d){b.change=function(){var c=b.setting.model,d=b.plugin[c],e=b.setting.change;a.set(b.plugin.name,c,d),angular.isFunction(e)&&e()}},templateUrl:"js/arethusa.core/templates/plugin_setting.html"}}]),angular.module("arethusa.core").directive("pluginSettings",[function(){return{restrict:"A",templateUrl:"js/arethusa.core/templates/plugin_settings.html"}}]),angular.module("arethusa.core").directive("prevToken",["state",function(a){return{restrict:"AE",link:function(b,c,d){c.bind("click",function(c){b.$apply(a.selectPrevToken())})}}}]),angular.module("arethusa.core").directive("relocate",["relocateHandler","translator",function(a,b){return{restrict:"A",scope:{},link:function(b,c,d){a.defined&&(b.locations=a.locations,b.relocate=function(b){a.relocate(b)})},templateUrl:"js/arethusa.core/templates/relocate.html"}}]),angular.module("arethusa.core").directive("resizable",["$window","$document","keyCapture",function(a,b,c){var d=25;return{restrict:"AEC",link:function(e,f,g){function h(a){i(Math.floor(a.pageX))}function i(a){var b=Math.round(p.position().left),c=Math.round(p.width()),d=a-b,e=c-d,f=n.width()+d;l(e,f)&&(p.width(e),n.width(f))}function j(){i(Math.round(p.position().left)+d)}function k(){i(Math.round(p.position().left)-d)}function l(a,b){return a>q&&b>r}function m(){o.trigger("resize"),b.unbind("mousemove",h),b.unbind("mouseup",m)}var n=angular.element(document.getElementById("main-body")),o=angular.element(a),p=f.parent(),q=260,r=260;f.on("mousedown",function(a){a.preventDefault(),b.on("mousemove",h),b.on("mouseup",m)});c.initCaptures(function(a){return{sidepanelResizing:[a.create("grow",k,"←"),a.create("shrink",j,"→")]}})}}}]),angular.module("arethusa.core").directive("revealToggle",function(){return{restrict:"A",link:function(a,b,c){function d(){return angular.element(document.getElementById(e))}var e=c.revealToggle,f=c.alwaysReveal,g=c.slide;b.bind("click",function(){var a=d();f||a.hasClass("hide")?(g&&a.slideDown(),a.removeClass("hide"),a.trigger("show-"+e)):(g&&a.slideUp(),a.addClass("hide"),a.trigger("hide-"+e))})}}}),angular.module("arethusa.core").directive("rootToken",["state","globalSettings","depTree",function(a,b,c){return{restrict:"A",scope:{id:"@rootId",sentenceId:"@"},link:function(a,d,e){function f(b){a.$apply(b())}function g(){return b.clickActions[j][1]}function h(c,e){b.clickAction===j&&g()[c](a.id,d,e)}function i(){this.id=a.id,this.sentenceId=a.sentenceId}var j="change head";d.bind("click",function(){b.clickAction===j&&f(function(){c.changeHead(new i)})}),d.bind("mouseenter",function(a){f(function(){d.addClass("hovered"),h("mouseenter",a)})}),d.bind("mouseleave",function(a){f(function(){d.removeClass("hovered"),h("mouseleave",a)})})}}}]),angular.module("arethusa.core").directive("saver",["saver","translator",function(a,b){return{restrict:"A",scope:{},link:function(c,d,e){function f(){g(),i=c.$watch("saver.needsSave",function(a,b){a?(d.addClass("alert"),d.removeClass("disabled")):(d.addClass("disabled"),d.removeClass("alert"))})}function g(){i&&i()}function h(){d.attr("title",j+" "+k)}c.saver=a;var i;d.bind("click",function(){c.$apply(a.save())}),c.$watch("saver.canSave",function(a,b){a?(d.show(),f()):(d.hide(),g())});var j,k;c.$on("keysAdded",function(a,b){var c=b.saver;c&&(k=aU.formatKeyHint(c.save),h())}),b("save",function(a){j=a(),h()})},template:'<i class="fi-save"/>'}}]),angular.module("arethusa.core").directive("sentence",["navigator",function(a){return{restrict:"A",scope:{sentence:"="},link:function(b,c,d){function e(){a.getCitation(b.sentence,function(a){b.citation=a})}b.goTo=function(b){a.goTo(b),a.switchView()},b.sentenceString=b.sentence.toString(),b.id=b.sentence.id,e()},templateUrl:"js/arethusa.core/templates/sentence.html"}}]),angular.module("arethusa.core").directive("sentenceList",["$compile","navigator",function(a,b){return{restrict:"A",scope:!0,link:function(c,d,e){function f(){if(!b.hasList){b.list().append(a('              <div class="canvas-border"/>              <div id="canvas" class="row panel full-height scrollable" full-height>                <ul class="sentence-list">                  <li                     class="sentence-list"                    sentence="s"                    ng-repeat="s in n.sentences">                  </li>                </ul>              </div>            ')(c)),b.hasList=!0}}c.n=b,c.$on("viewModeSwitched",f),d.bind("click",function(){f(),c.$apply(function(){b.switchView()})})}}}]),angular.module("arethusa.core").directive("settingsTrigger",["translator",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){var e=d.settingsTrigger||"left",f="margin-"+("left"===e?"right":"left"),g="left"===e?"":"bw-";c.addClass(e),c.addClass("rotate-"+g+"on-hover"),c.css(f,"10px"),a("settings",function(a){c.attr("title",a())})},templateUrl:"js/arethusa.core/templates/settings_trigger.html"}}]),angular.module("arethusa.core").directive("sidepanel",["sidepanel","keyCapture","plugins",function(a,b,c){return{restrict:"A",link:function(d,e,f){function g(){return c.sub.indexOf(c.active)}function h(){return c.sub.length-1}function i(a){var b=c.sub[a];c.setActive(b)}function j(){var a=g();i(a===h()?l:a+1)}function k(){var a=g();i(a===l?h():a-1)}var l=0,m=b.initCaptures(function(b){return{sidepanel:[b.create("nextTab",function(){b.doRepeated(j)},"W"),b.create("prevTab",function(){b.doRepeated(k)},"E"),b.create("toggle",function(){a.toggle()},"q")]}});angular.extend(a.activeKeys,m.sidepanel)}}}]),angular.module("arethusa.core").directive("sidepanelFolder",["sidepanel","$window","translator",function(a,b,c){return{scope:{},link:function(d,e,f){function g(){var b=a.folded?"expand":"compress",c=a.folded?"show":"fold",f=arethusaUtil.formatKeyHint(a.activeKeys.toggle);d.iconClass="fi-arrows-"+b,e.attr("title",d.translations[c]()+" "+f)}var h=angular.element(b);d.translations=c({"sidepanel.show":"show","sidepanel.fold":"fold"}),d.$watch("translations",function(a,b){a!==b&&g()},!0),e.on("click",function(){a.toggle(),d.$apply(g())}),d.sp=a;var i=function(){};d.$watch("sp.active",function(a){a?(e.show(),i=d.$watch("sp.folded",function(a,b){g(),h.trigger("resize")})):(e.hide(),i())})},template:'<i ng-class="iconClass"/>'}}]),angular.module("arethusa.core").directive("spinner",["spinner",function(a){return{restrict:"A",link:function(b,c,d){b.spinner=a,b.$watch("spinner.spinning",function(a,c){b.visible=a})},template:'<i ng-show="visible" class="fa fa-spinner fa-spin info-message"></i>'}}]),angular.module("arethusa.core").directive("toBottom",["$window","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){return d.parents(".gridster-item")}function g(){b(function(){var a=d.offset().top,b=h.offset().top+h.height();d.height(b-a);var c=d.find("svg");if(c[0]){d[0].getBoundingClientRect().bottom,c.offset().top}})}var h;if(aU.isArethusaMainApplication()){var i=f();i[0]?h=i:(h=angular.element(document.getElementById("canvas")),angular.element(a))}else h=d.parents('[ng-controller="ArethusaCtrl"]');angular.element(a).on("resize",g),c.$on("stateLoaded",g),g()}}}]),angular.module("arethusa.core").directive("token",["state","globalSettings",function(a,b){return{restrict:"AE",scope:{token:"=",colorize:"=",click:"@",hover:"@",highlight:"@"},link:function(c,d,e){function f(a){c.$apply(a())}function g(){d.bind("click",function(c){f(function(){var d=c.ctrlKey?"ctrl-click":"click";"click"===d&&a.hasClickSelections()?b.clickFn(n):a.toggleSelection(n,d)})})}function h(){d.bind("mouseenter",function(){f(function(){a.selectToken(n,"hover")})}),d.bind("mouseleave",function(){f(function(){a.deselectToken(n,"hover")})})}function i(){var a=b.preClickFn;a&&angular.forEach(a,function(a,b){d.bind(b,function(b){f(function(){a(n,d,b)})})})}function j(){c.click&&(g(),d.addClass("clickable"),i()),c.hover&&h()}function k(){d.removeClass("clickable"),d.unbind()}function l(){k(),j()}function m(){angular.forEach(c.token.style,function(a,b){d.css(b,"")})}if(c.token){angular.isObject(c.token)||(c.token=a.getToken(c.token)),c.state=a;var n=c.token.id;c.selectionClass=function(){if(a.isSelected(n))return"hover"==a.selectionType(n)?"hovered":"selected"},c.$on("clickActionChange",l),c.$watch("colorize",function(a,b){a?angular.isObject(a)?d.css(a):d.css(c.token.style||{}):m()}),c.$watch("token.style",function(a,b){a!==b&&(a?(d.removeAttr("style"),d.css(a)):m())},!0),c.token.artificial&&d.addClass(c.token.type),d.addClass("token"),j()}},templateUrl:"js/templates/token.html"}}]),angular.module("arethusa.core").directive("tokenSelector",["state","_","StateChangeWatcher","Highlighter","translator",function(a,b,c,d,e){return{restrict:"A",scope:{tokens:"=tokenSelector"},link:function(f,g,h){function i(){x.isActive?r.unapplyHighlighting():r.applyHighlighting(),x.isActive=!x.isActive}function j(a){return function(b){a.label=b(a)}}function k(a){return function(b){a.tooltip=b(a)}}function l(a,b){var c="selector."+b;e(c,j(a)),e(c+"Tooltip",k(a))}var m=!0,n=!1,o=f.style||{"background-color":"rgb(255, 216, 216)"};f.state=a,f.$watch("state.hasClickSelections()",function(b,c){m=0===b,n=b===a.totalTokens,z()});var p={newMatch:function(b){x.isActive&&a.addStyle(b.id,o)},lostMatch:function(a){x.isActive&&r.removeStyle(a.id)},changedCount:function(a){w.count=a,e("selector.unused",j(w))}},q=new c("head.id",p),r=new d(q,o),s=function(){a.multiSelect(Object.keys(f.tokens))},t=function(){r.unapplyHighlighting(),a.multiSelect(Object.keys(q.matchingTokens))};f.selection={},l(f.selection,"selection");var u={action:function(){a.deselectAll(),r.applyHighlighting()},isActive:!0};l(u,"none");var v={action:s,isActive:!1};l(v,"all");var w={action:t,isActive:!1,count:0};l(w,"unused");var x={action:i,styleClasses:"unused-highlighter",isActive:!1};l(x,"highlightUnused"),f.selectors=[u,w,x];var y=function(c){return b.all(Object.keys(c),function(b){return a.isClicked(b)})},z=function(){u.isActive=m,v.isActive=n,w.isActive=!m&&a.hasClickSelections()===q.count&&y(q.matchingTokens)};f.$watch("state.tokens",function(a,b){q.initCount()})},templateUrl:"js/arethusa.core/templates/token_selector.html"}}]),angular.module("arethusa.core").directive("tokenWithId",["idHandler",function(a){return{restrict:"A",scope:{value:"=",tokenId:"="},link:function(b,c,d){function e(c){b.formatted=a.formatId(c,"%s-%w")}b.$watch("tokenId",e)},template:'<span>{{ value }} <sup class="note">{{ formatted }}</sup>'}}]),angular.module("arethusa.core").directive("translateLanguage",["$translate","translator","LOCALES",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e,f){function g(b){i=b||a.use()||"en",a.use(i),d.lang=i}function h(){var a;a=c.indexOf(i)+1,a=a>c.length-1?0:a,g(c[a])}var i;e.bind("click",function(){d.$apply(h)});var j=e.parent();b("language",function(a){j.attr("title",a())}),g()},templateUrl:"js/arethusa.core/templates/translate_language.html"}}]),angular.module("arethusa.core").directive("unusedTokenHighlighter",["state","$window","translator","StateChangeWatcher","Highlighter",function(a,b,c,d,e){return{restrict:"A",scope:{highlightMode:"@unusedTokenHighlighter",style:"=unusedTokenStyle",uthCheckProperty:"@",uthAuxiliaryProperty:"@"},link:function(f,g,h){function i(){n.unapplyHighlighting(),a.multiSelect(Object.keys(m.matchingTokens))}var j=f.style||{"background-color":"rgb(255, 216, 216)"},k=!!f.highlightMode;f.s=a,f.total=a.totalTokens;var l={newMatch:function(b){k&&a.addStyle(b.id,j)},lostMatch:function(a){k&&n.removeStyle(a.id)},changedCount:function(a){f.unusedCount=a}},m=new d(f.uthCheckProperty,l,f.uthAuxiliaryProperty);m.initCount();var n=new e(m,j);k&&n.applyHighlighting(),g.bind("click",function(){f.$apply(function(){k?n.unapplyHighlighting():n.applyHighlighting()}),k=!k}),g.bind("dblclick",function(a){return f.$apply(function(){i()}),a.preventDefault(),b.getSelection().empty(),!1}),f.$watch("s.tokens",function(b,c){f.total=a.totalTokens,m.initCount()}),f.$on("tokenAdded",function(a,b){f.total++,m.initCount(),k&&n.applyHighlighting()}),f.$on("tokenRemoved",function(a,b){f.total--}),c("uth.tooltip",function(a){f.tooltip=a()})},template:'      <span      tooltip-html-unsafe="{{ tooltip }}"      tooltip-popup-delay="700"      tooltip-placement="left"      translate="uth.count"      translate-value-count="{{ unusedCount }}"      translate-value-total="{{ total }}">      '}}]),angular.module("arethusa.core").directive("valueWatch",function(){return{restrict:"A",scope:{target:"=",property:"@",emptyVal:"@"},link:function(a,b,c){a.$watch("target."+a.property,function(c,d){c?(a.value=c,b.removeClass("bold")):(a.value=a.emptyVal||"",b.addClass("bold"))})},template:"<span>{{ value }}</span>"}}),angular.module("arethusa.core").factory("apiOutputter",[function(a){return function(a){this._attributesToAlpheios=function(a,b){var c={};return angular.forEach(a,function(d,e){d=b.longAttributeValue(e,d),"pos"===e&&(e="pofs","verb"===d&&"participle"===a.mood?d="verb participle":"adposition"===d&&(d="preposition")),"degree"===e&&(e="comp"),"tense"===e&&"plusquamperfect"===d&&(d="pluperfect"),"voice"===e&&"medio-passive"===d&&(d="mediopassive"),c[e]={$:d}}),c},this.outputMorph=function(b,c,d){var e={RDF:{Annotation:{about:"urn:uuid:"+a.newuuid(),creator:{Agent:{about:""}},created:{$:""},rights:{$:""},hasTarget:{Description:{about:""}}}}},f=b.morphology;if(f){var g={},h="urn:uuid:"+a.newuuid();angular.isDefined(f.lemma)&&(g.dict={hdwd:{lang:c,$:f.lemma}}),angular.isDefined(f.postag)&&(g.infl=this._attributesToAlpheios(f.attributes,d),g.infl.term={form:{$:b.string}});var i=[];angular.isDefined(f.gloss)&&i.push({$:f.gloss}),angular.isDefined(f.alternateGloss)&&i.push({$:f.alternateGloss}),i.length>1?g.mean=i:1==i.length&&(g.mean=i[0]),angular.isDefined(f.notes)&&(g.note={$:f.notes}),e.RDF.Annotation.hasBody={resource:h},e.RDF.Annotation.Body={about:h,type:{resource:"cnt:ContentAsXML"},rest:{entry:g}}}return e}}}]),angular.module("arethusa.core").factory("Auth",["$resource","$cookies","$timeout","$injector","translator",function(a,b,c,d,e){function f(){return i||(i=d.get("notifier")),i}function g(b,c){if(b){var d=a(b,null,{get:{withCredentials:c}});this.checkAuth=function(a,b){d.get(a,b)}}else this.checkAuth=function(a,b){a()}}function h(){}var i,j=e("auth.notLoggedIn",j,"notLoggedIn");return function(a,d){function e(){return arethusaUtil.isIncluded(n,d())}function i(){m=!0,f().warning(j.notLoggedIn(),null,500)}function k(a){403===a.status&&i()}var l=this;l.conf=a;var m,n=a.skipModes||[];this.withCredentials=!!a.crossDomain;var o=new g(a.ping,this.withCredentials);this.checkAuthentication=function(){e()||o.checkAuth(h,k)},this.withAuthentication=function(a,b){var d=function(b){k(b),a.reject(b)},f=function(b){m=!1,a.resolve(b)},g=function(){b().then(f,d)};if(!m||e())g();else{var h=function(){c(g,150)};o.checkAuth(h,d)}},this.transformRequest=function(a){"CSRF"==l.conf.type&&(a()[l.conf.header]=b[l.conf.cookie])}}}]),angular.module("arethusa.core").factory("confUrl",["CONF_PATH","$route",function(a,b){return function(c){var d=b.current.params,e=a+"/";return d.conf?e+d.conf+".json":d.conf_file?d.conf_file:c?e+"default.json":void 0}}]),angular.module("arethusa.core").factory("DocumentResolver",["configurator","_",function(a,b){return function(c){function d(a,c){f.get().then(function(d){var f=d.data;b.forEach(f,function(b,d){var f=e(a,d);if(f){var g={doc:b};f.get(g,c(f))}})})}function e(a,b){var d=c.map[b];if(d)return a[d]}var f=a.provideResource(c.resource);this.resolve=d}}]),angular.module("arethusa.core").factory("globalStore",[function(){return{}}]),angular.module("arethusa.core").factory("Highlighter",["state",function(a){return function(b,c){var d=this;this.applyHighlighting=function(){b.applyToMatching(function(b){a.addStyle(b,c)})},this.removeStyle=function(b){var d=Object.keys(c);a.removeStyle(b,d)},this.unapplyHighlighting=function(){b.applyToMatching(function(a){d.removeStyle(a)})}}}]),angular.module("arethusa.core").factory("Resource",["$resource","$q","locator","spinner",function(a,b,c,d){function e(a){return arethusaUtil.inject({},a,function(a,b,d){a[b]=c.get(b)})}function f(a){if(a)return a.match("json")}function g(a,b){return angular.extend(e(a),b)||{}}function h(a,b){var c={};return c.data=f(b()["content-type"])?JSON.parse(a):a,c.headers=b,c.source="tbd",c}function i(){return b.defer()}return function(c,d){function e(){return k=i(),a(j.route,null,{get:{method:"GET",withCredentials:d.withCredentials,transformResponse:h,timeout:k.promise},save:{method:"POST",withCredentials:d.withCredentials,transformRequest:function(a,b){var c=j.mimetype||"application/json";return b()["Content-Type"]=c,f(c)&&(a=angular.toJson(a)),j.auth.transformRequest(b),a},transformResponse:h}})}var j=this;this.route=c.route,this.params=c.params||[],this.auth=d,d.checkAuthentication();var k;this.resource=e(),this.get=function(a){var b=g(j.params,a);return j.resource.get(b).$promise};this.save=function(a,c){var e=g(j.params,{});j.mimetype=c;var f=b.defer(),h=f.promise;return d.withAuthentication(f,function(){return j.resource.save(e,a).$promise}),h},this.post=this.save,this.abort=function(){k.resolve(),j.resource=e()}}}]),angular.module("arethusa.core").factory("StateChange",["$parse",function(a){function b(a,b){return angular.isObject(b)?b:a.getToken(b)}return function(c,d,e,f,g,h){function i(){c.change(j.token,e,j.oldVal)}var j=this,k=a(e),l=k.assign;this.token=b(c,d),this.property=e,this.newVal=f,this.oldVal=k(j.token),this.type="change",this.time=new Date,this.undo=function(){return angular.isFunction(g)?g():i()},this.exec=function(){return angular.isFunction(h)&&h(),l(j.token,j.newVal),c.broadcast("tokenChange",j),c.notifyWatchers(j),j}}}]),angular.module("arethusa.core").factory("StateChangeWatcher",["state","$parse",function(a,b){return function(c,d,e){function f(a,c){var d=b(a);return c?function(a){var b=d(a);return b&&b[c]}:d}function g(a){var b=h.auxiliaryProperty;return b?a&&a[b]:a}var h=this;this.checkFunction=f(c,e),this.auxiliaryProperty=e,this.initCount=function(){h.count=0,h.matchingTokens={},angular.forEach(a.tokens,function(a){h.checkFunction(a)||(h.count++,h.matchingTokens[a.id]=!0)}),d.changedCount(h.count)},this.watchChange=function(a,b,c){var e=c.token.id;g(a)?g(b)||(h.count--,delete h.matchingTokens[e],d.lostMatch(c.token),d.changedCount(h.count)):(h.count++,h.matchingTokens[e]=!0,d.newMatch(c.token),d.changedCount(h.count))},this.applyToMatching=function(a){angular.forEach(h.matchingTokens,function(b,c){a(c)})},a.watch(c,this.watchChange),a.on("tokenAdded",function(a,b){h.checkFunction(b)||(h.matchingTokens[b.id]=!0,d.newMatch(b),h.count++,d.changedCount(h.count))}),a.on("tokenRemoved",function(a,b){h.checkFunction(b)||(delete h.matchingTokens[b.id],d.lostMatch(b),h.count--,d.changedCount(h.count))})}}]),angular.module("arethusa.core").factory("translator",["$rootScope","$translate","$interpolate",function(a,b,c){function d(){}function e(a,e,f){var g=angular.isFunction(e),h=function(a){arethusaUtil.setProperty(e,f,a)};g||h(d),b(a,null,"nullInterpolator").then(function(a){var b=c(a);g?e(b):h(b)})}function f(b,c,d){e(b,c,d),a.$on("$translateChangeSuccess",function(){e(b,c,d)})}return function(a,b,c){return b=b||{},angular.isObject(a)?angular.isArray(a)?angular.forEach(a,function(a){f(a,b,a)}):angular.forEach(a,function(a,c){f(c,b,a)}):f(a,b,c),b}}]),angular.module("arethusa.core").factory("translatorNullInterpolator",function(){return{getInterpolationIdentifier:function(){return"nullInterpolator"},interpolate:function(a){return a},setLocale:function(){}}}),angular.module("arethusa.core").factory("Tree",["$compile","languageSettings","keyCapture","idHandler","$window","state","$timeout","translator","plugins","navigator",function(a,b,c,d,e,f,g,h,i,j){return function(k,l,m){function n(){qa();var a,b;a=d3.event,b="translate("+a.translate+") scale("+a.scale+")",Ia.vis.attr("transform",b)}function o(){return'<span root-token root-id="'+Ga+'" sentence-id="'+S()+'">'+Na+"</span>"}function p(a){return"js/arethusa.dep_tree/templates/"+a+".html"}function q(b){var c='<span class="right" ng-include="'+b+'"/>';angular.element(l[0].previousElementSibling).append(a(c)(k))}function r(){return'<div id="tph'+Ga+'">'+Na+"</div>"}function s(a){return'<div class="node token-node" id="tph'+a.id+'">'+a.string+"</div>"}function t(a){return'<div id="'+H(a.id)+'" class="text-center tree-label">xxxxxxxxxxx</div>'}function u(b){var c=k.$new();return Ia.childScopes.push(c),c.obj=b.relation,a(Wa)(c)[0]}function v(b){var c=k.$new();Ia.childScopes.push(c),c.token=b;var d;return k.styles?(w(b)&&x(c,b),d="style"):d="true",a(Va.replace("STYLE",d))(c)[0]}function w(a){return(k.styles[a.id]||{}).token}function x(a,b){a.style=k.styles[b.id].token}function y(){Ia.vis.selectAll("g.edgePath path");angular.forEach(k.styles,function(a,b){var c=a.label,d=a.edge,e=G(b),f=D(b);c&&e[0][0]&&(z(b,e,c,Ya),e.style(c)),d&&f[0][0]&&(z(b,f,d,Xa),f.style(d))})}function z(a,b,c,d){if(c){var e={};angular.forEach(c,function(a,c){e[c]=b.style(c)}),d[a]=e}}function A(){angular.forEach(Xa,function(a,b){D(b).style(a)}),Xa={}}function B(){angular.forEach(Ya,function(a,b){G(b).style(a)}),Ya={}}function C(){return Ia.vis.selectAll("g.edgePath path")}function D(a){return Ia.vis.select("#"+F(a))}function E(a){return D(a)[0][0]}function F(a){return"tep"+a}function G(a){return Ia.vis.select("#"+H(a))}function H(a){return"tel"+a}function I(a){return"tph"+a}function J(a){return Ia.vis.select("#"+I(a))}function K(){return Ia.vis.selectAll("div.node.token-node")}function L(){return Ia.vis.selectAll(function(){return this.getElementsByTagName("foreignObject")})}function M(a){return Ia.g._nodes[a]}function N(a){return aU.getProperty(a,m.mainAttribute)}function O(a,b){if(a&&b)return angular.equals(Object.keys(a),Object.keys(b))}function P(a){if(ta()){a||Q();var b=k.current;if(k.current=k.groupedTokens[k.currentFocus],O(k.current,b))return}else k.current=k.tokens;R(),Ia.g=new dagreD3.Digraph,m.syntheticRoot&&T(),V(),$()}function Q(){k.groupedTokens=aU.map(j.currentSentences,"tokens"),k.groupSize=k.groupedTokens.length}function R(){Ia.vis&&Ia.vis.selectAll("*").remove()}function S(){for(var a in k.current)break;return k.current[a].sentenceId}function T(){Ga=d.getId("0",S()),Ia.g.addNode(Ga,{label:r()})}function U(a){Ia.g.addNode(a.id,{label:s(a)})}function V(){angular.forEach(k.current,function(a,b){N(a)&&Ia.drawEdge(a)})}function W(a){E(a.id)&&Ia.g.delEdge(a.id),Ia.drawEdge(a)}function X(a){a.$destroy()}function Y(){angular.forEach(Ia.childScopes,X),Ia.childScopes=[]}function Z(){Y(),m.syntheticRoot&&_(),Ia.insertNodeDirectives(),Ia.insertEdgeDirectives()}function $(){Ia.vis=Sa.select("g"),Ua.layout(k.layout).run(Ia.g,Ia.vis),Z(),C().each(function(a){angular.element(this).attr("id",F(a))}).attr("marker-end",""),L().each(function(){var a=angular.element(this);if(a.find(".node").length){var b=a.attr("width");a.attr("width",parseInt(b)+1)}angular.element(this.children[0]).attr("style","float: center;"),angular.element(this).attr("overflow","visible")}),g(function(){l.find(".token").removeClass("no-transition")})}function _(){J(Ga).append(function(){return this.textContent="",a(o())(k)[0]})}function aa(){Ia.insertTokenDirectives()}function ba(){K().append(function(){return this.textContent="",v(k.current[this.id.slice(3)])})}function ca(){angular.forEach(k.current,function(a,b){G(b).append(function(){return this.textContent="",u(a)})})}function da(){k.nodeSep=30,k.edgeSep=10,k.rankSep=30}function ea(){k.nodeSep=80,k.edgeSep=5,k.rankSep=40}function fa(){var a=b.getFor("treebank");return!a||a.leftToRight}function ga(a,b,c){ia(a,b,c);var d="translate("+a+","+b+" )",e=c?" scale("+c+")":"";Ia.vis.transition().attr("transform",d+e).duration(Ma).ease()}function ha(a,b){if(a){b=b||Ja;var c=na(a);ga(Qa-c.x,0-c.y+b)}}function ia(a,b,c){Ta.translate([a,b]),Ta.scale(c||1)}function ja(){return Ia.vis.node().getBBox()}function ka(){Pa=La.width(),Oa=La.height(),Qa=Pa/2,Ra=Oa/2}function la(a,b){this.x=a,this.y=b}function ma(a){var b=a.attr("transform"),c=/translate\((.*),(.*?)\)/.exec(b);return new la(c[1],c[2])}function na(a){return ma(angular.element(J(a)[0]).parents(".node"))}function oa(){angular.isDefined(Ha)&&Ha()}function pa(a){Ha=a}function qa(){Ha=void 0}function ra(){ja().width>Pa-2*Ja?k.perfectWidth():k.centerGraph()}function sa(a){P(a),ra(),ta()&&i.declareReady(m.parentPlugin)}function ta(){return k.tokens===f.tokens}function ua(a){return k.current[a]}function va(a){return!(angular.isDefined(a)&&""!==a)}function wa(a){return{tree:[a.create("directionChange",function(){k.changeDir()},"x"),a.create("centerTree",function(){k.centerGraph()},"s"),a.create("focusRoot",function(){k.focusRoot()}),a.create("focusSelection",function(){k.focusSelection()},"a"),a.create("perfectWidth",function(){k.perfectWidth()},"d")]}}function xa(){k.compactTree=Ia.compactTree,k.wideTree=Ia.wideTree,k.textDirection=fa(),k.rankDir="BT","vertical"===m.direction&&k.changeDir(),k.compactTree(),k.layout=dagreD3.layout().sortRankByIdAscending(k.textDirection).rankDir(k.rankDir).nodeSep(k.nodeSep).edgeSep(k.edgeSep).rankSep(k.rankSep)}function ya(){xa(),k.currentFocus=0,k.$watch("tokens",function(){sa()}),k.$watch("currentFocus",function(a,b){a!==b&&sa(!0)}),za(),l.append(La),q("panelTemplate"),l.prepend(a("<div dep-tree-navigator/>")(k)),ka()}function za(){Ba()||Ea()?_a.addClass("no-border"):_a.removeClass("no-border")}function Aa(){return l.parents(".gridster")}function Ba(){return Aa().length}function Ca(){return Aa().hasClass("gridster-loaded")}function Da(){return l.parents("#sidepanel")}function Ea(){return Da().length}function Fa(){}var Ga,Ha,Ia=this,Ja=15,Ka='        <svg class="full-height full-width">          <g transform="translate('+Ja+","+Ja+')"/>        </svg>      ',La=angular.element(Ka),Ma=700,Na="[ROOT]";this.g=void 0,this.vis=void 0;var Oa,Pa,Qa,Ra,Sa=d3.select(l[0]),Ta=d3.behavior.zoom();Sa.call(Ta.on("zoom",n).scaleExtent([.3,2.5]));var Ua=new dagreD3.Renderer;Ua.transition(function(a){return a.transition().duration(Ma)}),k.settingsOn=!1;var Va='        <span token="token"          style="white-space: nowrap"          class="no-transition"          colorize="STYLE"          click="true"          hover="true"/>      ',Wa='        <span         value-watch         target="obj"         property="label"         empty-val="NIL"/>      ';k.panelTemplate=p("settings");var Xa={},Ya={};this.drawEdge=function(a){var b=a.id;if(angular.isDefined(b)){var c=aU.getProperty(a,m.mainAttribute);M(b)||U(a),M(c)||U(k.current[c]),Ia.g.addEdge(b,b,c,{label:t(a)})}},k.changeDir=function(){var a;fa()?a="RL":(a="LR",k.textDirection=!k.textDirection),k.rankDir="BT"===k.rankDir?a:"BT"},k.centerGraph=function(){pa(k.centerGraph),ga((Pa-ja().width)/2,Ja)},k.refreshWidth=function(){pa(k.refreshWidth);var a=ja().width,b=Pa-2*Ja;if(a>b){ga(Ja,Ja,b/a)}else{ga((Pa-a)/2,Ja)}},k.perfectWidth=function(){var a=ja().width,b=Pa-2*Ja;if(0!==b&&0!==a){pa(k.perfectWidth);ga(Ja,Ja,b/a)}},k.focusRoot=function(){pa(k.focusRoot),ha(Ga)},k.focusSelection=function(){pa(k.focusSelection),ha(f.firstSelected(),Oa/3)},k.$watch("styles",function(a,b){a!==b&&(Z(),a?y():(A(),B()))});var Za={nodeSep:function(a){k.layout.nodeSep(a)},edgeSep:function(a){k.layout.edgeSep(a)},rankSep:function(a){k.layout.rankSep(a)},rankDir:function(a){k.layout.rankDir(a)},textDirection:function(a){k.layout.sortRankByIdAscending(a)}};if(angular.forEach(Za,function(a,b){k.$watch(b,function(b,c){b!==c&&(a(b),$(),g(oa,Ma))})}),ta()){f.on("tokenAdded",function(a,b){ua(b.id)&&(U(b),Z(),$())}),f.on("tokenRemoved",function(a,b){var c=b.id;ua(c)&&M(c)&&(Ia.g.delNode(c),$())});var $a;f.watch(m.mainAttribute,function(a,b,c){var d=c.token;if(ua(d.id)){if(a!==b&&(va(a)?Ia.g.delEdge(d.id):W(d)),f.batchChange)return void($a=!0);$(),g(oa,Ma)}}),f.on("batchChangeStop",function(){$a&&($(),g(oa,Ma),$a=!1)})}angular.element(e).on("resize",function(){ka(),oa()}),j.onRefresh(function(){$(),k.refreshWidth(),g(oa,Ma)});var _a=l.parents(".tree-canvas"),ab=c.initCaptures(wa);k.keyHints=arethusaUtil.inject({},ab.tree,function(a,b,c){a[b]=arethusaUtil.formatKeyHint(c)}),k.$on("$destroy",ab.$destroy),k.translations={};var bb=["changeDir","focusRoot","focusSel","centerTree","perfectWidth","compact","widen"];angular.forEach(bb,function(a,b){h("tree."+a,k.translations,a)}),this.launch=function(){Ba()&&!Ca()?g(ya,130):ya()},this.createEdges=Fa,this.nodePresent=M,this.createNode=U,this.insertNodeDirectives=aa,this.insertTokenDirectives=ba,this.insertEdgeDirectives=ca,this.compactTree=da,this.wideTree=ea,this.childScopes=[]}}]),angular.module("arethusa.core").factory("urlParser",[function(){function a(a){var b=a.search.slice(1),c=b.split("&");return arethusaUtil.inject({},c,function(a,b){var c=b.split("="),d=c[0],e=c[1]||!0,f=a[d],g=f?arethusaUtil.toAry(f).concat([e]):e;a[d]=g})}function b(a,b){return a+"="+b}function c(a,c){var d=a.url.replace(c.search,"?"),e=[];angular.forEach(a.params,function(a,c){angular.isArray(a)?angular.forEach(a,function(a){e.push(b(c,a))}):e.push(b(c,a))}),a.url=d+e.join("&")}function d(b){var d=this,e=document.createElement("a");e.href=b,this.url=b,this.params=a(e),this.set=function(a,b){angular.isString(a)&&b&&(this.params[a]=b),c(d,e)}}return function(a){return new d(a)}}]),angular.module("arethusa.core").factory("User",[function(){return function(a){this.name=a.name,this.fullName=a.fullName,this.mail=a.mail,this.page=a.page}}]),angular.module("arethusa.core").filter("keys",function(){return function(a){return a?Object.keys(a):[]}}),angular.module("arethusa.core").constant("LANDING",{controller:"LandingCtrl",template:'    <div style="height: 100%; overflow: auto">      <div        ng-include="template"         class="fade slow">      </div>    </div>  ',resolve:{scrollBody:function(){angular.element(document.body).css("overflow","auto")},conf:["configurator",function(a){a.defineConfiguration({navbar:{template:"js/templates/navbar_landing.html"}})}]}}),angular.module("arethusa.core").constant("MAIN_ROUTE",{controller:"ArethusaCtrl",template:'    <div>      <arethusa-navbar></arethusa-navbar>      <div        ng-include="gS.layout.template"         class="fade slow">      </div>    </div>  ',resolve:{loadConfiguration:["$http","confUrl","configurator",function(a,b,c){var d=b(!0);return a.get(d).then(function(a){c.defineConfiguration(a.data,d)})}]}}),angular.module("arethusa.core").constant("MORPH_TOOLS",{controller:"MorphToolsCtrl",templateUrl:"js/arethusa.tools/templates/morph_tools.html",resolve:{latinAttrs:["$http",function(a){return a.get("js/arethusa.morph/configs/morph/lat_attributes.json")}],greekAttrs:["$http",function(a){return a.get("js/arethusa.morph/configs/morph/gr_attributes2.json")}]}}),angular.module("arethusa.core").service("api",["state","idHandler","apiOutputter","documentStore","navigator","plugins","uuid2",function(a,b,c,d,e,f,g){function h(){return k||(k=f.get("morph")),k}function i(){if(!l){var a=d.store.treebank;if(void 0!==a){var b=a.json.treebank||a.json.book;b&&(l=b["_xml:lang"])}}return l}function j(){return m||(m=f.get("search")),m}this.outputter=new c(g);var k,l,m;this.isReady=function(){return a.arethusaLoaded},this.getMorph=function(c,d){return this.outputter.outputMorph(a.getToken(b.getId(d,c)),i(),h())},this.getSubdoc=function(){return e.currentSubdocs()[0]},this.refreshView=function(){e.triggerRefreshEvent()},this.nextSentence=function(){e.nextChunk()},this.prevSentence=function(){e.prevChunk()},this.gotoSentence=function(c,d){e.goTo(c);var f=[];d&&d.length>0&&(arethusaUtil.inject(f,d,function(a,d){var e=b.getId(d,c);arethusaUtil.pushAll(a,[e])}),a.multiSelect(f))},this.findWord=function(b,c,d,f){e.goTo(b),null==d&&(d=""),null==f&&(f="");var g=j().queryWordInContext(c,d,f),h=[];return angular.forEach(g,function(b){h.push(a.getToken(b).idMap.mappings.treebank.sourceId)}),h}}]),angular.module("arethusa.core").service("arethusaGrid",["gridsterConfig","$window","plugins","$rootScope","notifier","globalSettings",function(a,b,c,d,e,f){function g(a,b,c,d){return b=b||[],c=c||[],{sizeX:b[0],sizeY:b[1],row:c[0],col:c[1],plugin:a,style:d}}function h(a){for(var b,c=n.items.length-1;c>=0;c--){var d=n.items[c];if(d.plugin===a){b=d;break}}return b}function i(a,b){b.grid&&(j(),m())}function j(){n.items=arethusaUtil.map(f.layout.grid,function(a){return new g(a.plugin,a.size,a.position,a.style)})}function k(){n.itemList=arethusaUtil.inject({},c.all,function(a,b,c){a[b]=!1})}function l(){angular.forEach(n.items,function(a,b){n.itemList[a.plugin]=!0})}function m(a){k(),l()}var n=this,o=angular.element(b);this.settings={dragging:!0,resizing:!0,pushing:!0,floating:!0},this.setDragging=function(a){n.options.draggable.enabled=a},this.setResizing=function(a){n.options.resizable.enabled=a},this.setPushing=function(a){n.options.pushing=a},this.setFloating=function(a){n.options.floating=a},this.options=angular.extend(a,{columns:48,rowHeight:"match",defaultSizeX:6,defaultSizeY:4,resizable:{enabled:n.settings.resizing,handles:["n","e","s","w","ne","nw","se","sw"],stop:function(){o.triggerHandler("resize")}},draggable:{enabled:n.settings.dragging,handle:".drag-handle"}}),this.addItem=function(a){n.items.push(new g(a)),e.success(a+" added to the grid!")},this.removeItem=function(a){var b=n.items.indexOf(h(a));n.items.splice(b,1),e.info(a+" removed from grid!")},this.toggleItem=function(a){n.itemList[a]?n.addItem(a):n.removeItem(a)},this.init=function(){d.$on("layoutChange",i),i(null,f.layout)},j(),d.$on("pluginsLoaded",n.init),c.loaded&&n.init()}]),angular.module("arethusa.core").service("arethusaLocalStorage",["localStorageService",function(a){function b(a){return-1===c.indexOf(a)?a:JSON.parse(a)}this.get=function(c){return b(a.get(c))},this.set=a.set,this.keys=a.keys;var c=["true","false","null"]}]),angular.module("arethusa.core").service("configurator",["$injector","$http","$rootScope","Resource","Auth","$timeout","$location","$q","BASE_PATH",function(a,b,c,d,e,f,g,h,i){function j(){function a(){return l.configuration.main.globalDefaults||{}}function b(){var a=["mode"];return arethusaUtil.inject({},a,function(a,b){var c=g.search()[b];c&&(a[b]=c)})}var c={mode:"viewer"},d=a(),e=b();return angular.extend({},c,d,e)}var k,l=this,m=["main","navbar","notifier"];this.getConfTemplate=function(){function a(){this.main={},this.plugins={},this.resources={}}return new a},this.mergeConfigurations=function(a,b){var c=this;return angular.forEach(b,function(b,d){var e=a[d];e?angular.isArray(e)?arethusaUtil.pushAll(e,b):angular.isObject(e)?c.mergeConfigurations(e,b):a[d]=b:a[d]=b}),a},this.shallowMerge=function(a,b){function c(a,b){angular.forEach(m,function(c,d){var f=a[c],g=b[c];g&&e(c,f,g,a)});var c=a.main,d=b.main;d&&angular.extend(c,d)}function d(a,b){var c=a.plugins,d=b.plugins;d&&angular.forEach(d,function(b,d){e(d,c[d],b,a)})}function e(a,b,c,d){b?angular.extend(b,c):d[a]=c}return c(a,b),d(a,b),a},this.delegateConf=function(b,c,d){function e(){return k||(k=a.get("userPreferences")),k}function f(a){angular.forEach(j(),function(b,c){void 0===a[c]&&(a[c]=b)})}var g=["displayName","main","template","external","contextMenu","contextMenuTemplate","noView","mode"],h=d?c:arethusaUtil.pushAll(g,c),i=b.defaultConf||{},l=function(a){return void 0!==a&&null!==a};angular.forEach(h,function(a,c){if(!d||!l(b[a])){var f=e().get(b.name,a),g=b.conf[a],h=l(f)?f:l(g)?g:i[a];b[a]=h}}),b.displayName||(b.displayName=b.name),f(b)},this.getConfAndDelegate=function(a,b){return a.conf=l.configurationFor(a.name),l.delegateConf(a,b),a},this.getStickyConf=function(a,b){return a.conf=l.configurationFor(a.name),l.delegateConf(a,b,!0),a},this.configuration=this.getConfTemplate(),this.defineConfiguration=function(a,b){this.configuration=angular.extend(l.getConfTemplate(),a),this.confFileLocation=b,f(function(){c.$broadcast("confLoaded")})},this.loadAdditionalConf=function(c){function d(a){function b(){return l.configuration.main.auxConfPath}if(a.match("^http://"))return a;var c=b(),d="/"+a+".json";return c.match("^./")?i+c.substr(1)+d:c+d}function e(){return a.get("notifier")}var f=arethusaUtil.inject([],c,function(a,c,f){var g;if("fullFile"==c){var h=function(a){l.shallowMerge(l.configuration,a.data),e().info(f+" configuration loaded!")},i=function(){e().warning("Failed to retrieve "+f)};g=b.get(d(f)).then(h,i)}else g=b.get(f).then(function(a){angular.extend(l.configurationFor(c),a.data)});a.push(g)});return h.all(f)},this.configurationFor=function(a){var b=l.configuration;return b[a]||b.plugins[a]||b.resources[a]||{}},this.addPluginConf=function(a,b){l.configuration.plugins[a]=b},this.getRetrievers=function(a){return arethusaUtil.inject({},a,function(a,b,c){var d=l.getService(b);a[b]=new d(c)})},this.getPersisters=this.getRetrievers,this.getRetriever=function(a){var b=l.getRetrievers(a);return b[Object.keys(b)[0]]},this.getService=function(b){return a.get(b)},this.getServices=function(a){if(a){var b=this;return arethusaUtil.inject({},a,function(a,c){a[c]=b.getService(c)})}return{}},this.provideResource=function(a){var b=l.configuration.resources[a];if(b)return new d(b,l.provideAuth(b.auth))},this.provideAuth=function(a){function b(){return l.configuration.auths||{}}return new e(b()[a]||{},l.mode)},this.mode=function(){return j().mode}}]),angular.module("arethusa.core").service("confirmationDialog",["$modal","$rootScope",function(a,b){this.ask=function(c){var d=b.$new();d.message=c;var e=a.open({templateUrl:"js/arethusa.core/templates/confirmation_dialog.html",windowClass:"confirmation-modal",scope:d}).result;return e.finally=function(){d.$destroy()},e}}]),angular.module("arethusa.core").service("dependencyLoader",["$ocLazyLoad","$q","BASE_PATH",function(a,b,c){var d=this;this.load=function(b){function d(a){function b(a){return aU.isUrl(a)?a:c+"/"+a}if(angular.isArray(a))return aU.map(a,b);if(angular.isString(a))return b(a);var d=aU.map(a.files,b);return a.files=d,a}return a.load(d(b))},this.loadInOrder=function(a){var c=b.defer(),e=[c.promise];return angular.forEach(a,function(a,c){var f=b.defer();e.push(f.promise),e[c].then(function(){d.load(a).finally(aU.resolveFn(f))})}),c.resolve(),aU.last(e)}}]),angular.module("arethusa.core").service("documentStore",function(){var a=this;this.reset=function(){this.store={},this.confs={}},this.addDocument=function(b,c){function d(b){angular.extend(a.confs,b.conf)}a.store[b]=c,d(c)},this.hasAdditionalConfs=function(){return!angular.equals(a.confs,{})},this.reset()}),angular.module("arethusa.core").service("editors",["User",function(a){var b=this;this.perDocument={},this.addEditor=function(c,d){var e=b.perDocument[c];e||(e=b.perDocument[c]=[]),e.push(new a(d)),b.editorsPresent=!0},this.editorsPresent=!1}]),angular.module("arethusa.core").service("errorDialog",["$modal","$rootScope",function(a,b,c){function d(c,d){var e=b.$new();e.message=c,e.trace=d;var f=a.open({templateUrl:"js/arethusa.core/templates/error_dialog.html",windowClass:"error-modal",scope:e}).result;return f.finally=function(){e.$destroy()},f}this.sendError=function(a,b){d(a,b?printStackTrace({e:b}):printStackTrace()).then(function(){})}}]),angular.module("arethusa.core").service("exitHandler",["$location","$window","configurator","$analytics","$rootScope",function(a,b,c,d,e){function f(){return arethusaUtil.inject({},o,function(b,c){b[c]=a.search()[c]})}function g(a,b){if(!angular.equals({},b)){a+="?";a+=arethusaUtil.inject([],b,function(a,b,c){a.push(b+"="+c)}).join("&")}return a}function h(){var a=f(),b=n,c=arethusaUtil.inject({},a,function(a,c,d){b.indexOf(":"+c)>-1?b=b.replace(":"+c,d):a[c]=d});return g(b,c)}function i(a){d.eventTrack("exit",{category:"actions",label:"exit"}),a=a||"_self",k(),b.open(h(),a)}function j(a){e.$on(l,a)}function k(){e.$broadcast(l)}var l="exit:leave",m=c.configurationFor("exitHandler")||{};this.defined=!angular.equals({},m),this.title=m.title;var n=m.route,o=m.params;this.leave=i,this.onLeave=j,this.triggerLeaveEvent=k}]),angular.module("arethusa.core").service("fileHandler",["$window",function(a){function b(b,c){if(!angular.isDefined(a.FileReader))return void alert("Your browser does not support this feature - use Chrome, Firefox or Opera");h||(h=document.createElement("input"),h.setAttribute("type","file"),h.addEventListener("change",e(b,c))),g(h)}function c(a,b,c){if(i||(i=document.createElement("a")),!angular.isDefined(i.download))return void alert("Your browser does not support this feature - use Chrome, Firefox or Opera");var e=new Blob([b],{type:c+";charset=utf-8"});i.setAttribute("href",d(e)),i.setAttribute("download",a),g(i)}function d(b){return(a.URL||a.webkitURL).createObjectURL(b)}function e(b,c){return function(d){var e=d.target.files[0],g=new a.FileReader;g.onload=function(a){b(f(a.target.result,c))},g.readAsText(e)}}function f(a,b){return JSON.parse(a)}function g(a){document.body.appendChild(a),a.click(),document.body.removeChild(a)}var h,i;this.upload=b,this.download=c}]),angular.module("arethusa.core").service("globalSettings",["configurator","plugins","$injector","$rootScope","notifier","translator","keyCapture","$timeout",function(a,b,c,d,e,f,g,h){function i(){return q||(q=c.get("state")),q}function j(){return r||(r=c.get("userPreferences")),r}function k(){p.conf=a.configurationFor("main").globalSettings||{},a.delegateConf(p,t,!0),m()}function l(a,b,c,d){this.property=a,this.label=d||"globalSettings."+a,this.type=b||"checkbox",this.directive=c}function m(){p.defineSetting("persistSettings"),p.defineSetting("chunkMode","custom","chunk-mode-switcher"),p.defineSetting("clickAction","custom","global-click-action"),p.defineSetting("alwaysDeselect"),p.defineSetting("disableKeyboardMappings"),p.defineSetting("colorizer","custom","colorizer-setting"),p.defineSetting("layout","custom","layout-setting")}function n(){p.layouts=a.configurationFor("main").layouts,p.layout=p.layouts[0],p.broadcastLayoutChange()}function o(){if(!(p.layouts.length<2)){var a=(p.layouts.indexOf(p.layout)+1)%p.layouts.length;p.layout=p.layouts[a],p.broadcastLayoutChange()}}var p=this;p.name="globalSettings",p.layout={};var q,r;p.colorizers={disabled:!0};var s=f({"globalSettings.layoutLoaded":"layoutLoaded"}),t=["alwaysDeselect","colorizer","persistSettings","disableKeyboardMappings"];p.defaultConf={alwaysDeselect:!1,colorizer:"morph",persistSettings:!0,disableKeyboardMappings:!1},p.settings={},this.defineSetting=function(a,b,c,d){p.settings[a]=new l(a,b,c,d)},this.removeSetting=function(a){delete p.settings[a]},this.propagateSetting=function(a){j().set(p.name,a,p[a])},this.toggle=function(){p.active=!p.active};var u={};this.deselectAfterAction=function(a){u[a]=!0},this.noDeselectAfterAction=function(a){u[a]=!1},this.shouldDeselect=function(a){return p.alwaysDeselect||u[a]},this.defaultClickAction=function(a){i().toggleSelection(a,"click")},this.clickActions={},this.addClickAction=function(a,b,c){p.clickActions[a]=[b,c]},this.removeClickAction=function(a){delete p.clickActions[a],p.clickAction===a&&p.setClickAction("disabled")},this.setClickAction=function(a,b){if(p.clickAction!==a){p.clickAction=a;var c=p.clickActions[p.clickAction];p.clickFn=c[0],p.preClickFn=c[1],b||d.$broadcast("clickActionChange")}},this.addColorizer=function(a){p.colorizers[a]=!0},this.isColorizer=function(a){return p.colorizer===a},this.applyColorizer=function(){"disabled"===p.colorizer?i().unapplyStylings():p.colorizers[p.colorizer]&&b.get(p.colorizer).applyStyling()},this.colorMaps=function(){return arethusaUtil.inject({},p.colorizers,function(a,c,d){"disabled"!==c&&(a[c]=b.get(c).colorMap())})},d.$on("confLoaded",n),this.broadcastLayoutChange=function(){h(function(){e.info(s.layoutLoaded({layout:p.layout.name}))},500),d.$broadcast("layoutChange",p.layout)},g.initCaptures(function(a){return{layout:[a.create("cycle",o,"l")]}}),this.init=function(){k(),p.addClickAction("disabled",p.defaultClickAction),p.setClickAction("disabled",!0)}}]),angular.module("arethusa.core").service("help",[function(){var a=this;this.toggle=function(){a.active=!a.active},a.active=!1}]),angular.module("arethusa.core").service("idHandler",["errorDialog",function(a){function b(b,c,d){var e=!1;return angular.isDefined(g[d])||(g[d]={}),angular.isDefined(g[d][b])||(g[d][b]={}),g[d][b][c]||(e=g[d][b][c]=!0),e||a.sendError("Unexpected error calculating token mappings for sourceid: "+c),e}function c(a){return/(\d*)(\w*)?/.exec(a)}function d(a){return a.split("-")}function e(a,b){function e(a){var b=h.indexOf(a)-1;return h[b]}function g(a){var b=h.indexOf(a)+1;return h[b]}var i=d(a),j=i.pop(),k=i.pop(),l=c(j),m=l[1],n=l[2]||"";return n?n=b?g(n):e(n):b?m++:m--,f.getId(m,k)+n}var f=this,g={};this.getId=function(a,b){var c=b?arethusaUtil.formatNumber(b,4):"",d=arethusaUtil.formatNumber(a,4);return c?c+"-"+d:d},this.padIdWithSId=function(a,b){return aU.formatNumber(b,4)+"-"+a},this.formatId=function(a,b){if(a){b=b||"%w";var e,f=d(a),g=f.pop(),h=c(g),i=arethusaUtil.formatNumber(h[1]),j=arethusaUtil.formatNumber(f.pop(),0);return e=b.replace("%w",i+(h[2]||"")),b.indexOf(!1)&&(e=j?e.replace("%s",j):e.replace("%s-","")),e}},this.unassignSourceId=function(a){a.idMap.clearSourceIdAssignments(a.sentenceId)},this.Map=function(){var a=this;this.mappings={},this.add=function(c,d,e,f){function g(a,b){this.internalId=a,this.sourceId=b}return angular.isDefined(f)&&b(f,e,c)&&(a.mappings[c]=new g(d,e)),a.mappings[c]},this.sourceId=function(b){var c=a.mappings[b];if(c)return c.sourceId},this.clearSourceIdAssignments=function(b){angular.forEach(Object.keys(a.mappings),function(c,d){g[c][b][a.sourceId(c)]=!1})}},this.transformToSourceIds=function(a,b,c){function d(){var a=this;this.mapped={},this.unmapped=[],this.fullMap={},this.add=function(b,c,d){var e=b.idMap.sourceId(c),f=b.id;e?(a.mapped[e]=b,a.fullMap[f]=e):(a.unmapped.push(b),e=d(),angular.isDefined(b.idMap.add(c,f,e,b.sentenceId))&&(a.fullMap[f]=e))}}var e=new d;return arethusaUtil.inject(e,a,function(a,d,e){a.add(e,b,c)})};for(var h=[],i=97;i<123;i++)h.push(String.fromCharCode(i));this.isExtendedId=function(a){return a.match(/.*[a-z]$/)},this.extendId=function(a){return a+"e"},this.stripExtension=function(a){return f.isExtendedId(a)?a.slice(0,-1):a},this.decrement=function(a){return e(a,!1)},this.increment=function(a){return e(a,!0)},this.nonSequentialIds=function(a){var b={};return angular.forEach(a,function(c,d){var e=a[d+1];e&&f.decrement(e)!==c&&(b[d]=!0)}),b}}]),angular.module("arethusa.core").service("keyCapture",["configurator","$rootScope",function(a,b){function c(a){var b=a.split("-"),c=b.pop();return c.match(/[A-Z]/)&&(arethusaUtil.isIncluded(b,"shift")||b.push("shift"),c=c.toLowerCase()),[b,y[c]]}function d(a){return Object.keys(a.modifiers)}function e(a,b){var c=a.length-1,d=a[c],e=a.slice(0,c);return e.sort(function(a,c){return b[a]-b[c]}),e.concat(d)}function f(a){return(x.conf("keys")||{})[a]||{}}function g(a){var b=a.keyCode;return a.shiftKey&&(b+=x.shiftModifier),a.ctrlKey&&(b+=x.ctrlModifier),a.altKey&&(b+=x.altModifier),a.metaKey&&(b+=x.metaModifier),b}function h(a){b.$broadcast("keyCaptureLaunched",G[a]||a)}function i(a){if(!isNaN(a)){var b=parseInt(a)-48;return b>-1&&b<10}}function j(){F=""}function k(a,b){this.callback=a,this.priority=b||0}function l(a,b){G[a]=b}function m(a){return a.sort(function(a,b){return b.priority-a.priority})}function n(){H=!1}function o(a,b){angular.forEach(a,function(a,c){H||a.callback(b)})}function p(a,b,c){this.confKey=a,this.fn=b,this.defaultKey=c}function q(a,b,c,d){a[b]||(a[b]={}),a[b][c]=d}function r(a){var b=[];return angular.extend(x.activeKeys,a),angular.forEach(a,function(a,c){angular.forEach(a,function(a,d){var e=x.keyList[a];e||(e=x.keyList[a]=[]);var f=c+"."+d;e.push(f),b.push(function(){var b=x.activeKeys[c]||{},g=b[d];a===g&&delete b[d],t(e,f)})})}),s(b)}function s(a){return function(){for(var b=a.length-1;b>=0;b--)a[b]()}}function t(a,b){var c=a.indexOf(b);a.splice(c,1)}function u(){return x.conf("keys").us}function v(a,b){var c=a.style,d={lower:"0",upper:"1"};c.class=c.class||{},void 0===a.hide&&(c.class[d[b]]="inactive")}function w(a,b,c){var d=b.show,e=b[c];e&&(a[e]?d.push(a[e]):(v(b,c),d.push(e)))}var x=this;this.conf=function(b){return(a.configurationFor("keyCapture")||{})[b]||{}};for(var y={return:13,"↵":13,shift:16,ctrl:17,alt:18,esc:27,up:38,down:40,left:37,right:39,"←":37,"→":39,"↑":38,"↓":40,":":186,"[":219,"'":222,"]":221},z=97;z<123;z++)y[String.fromCharCode(z)]=z-32;var A=arethusaUtil.inject({},y,function(a,b,c){a[c]=b});this.codeToKey=function(a){return A[a]},this.keyToCode=function(a){return y[a]},this.shiftModifier=1e3,this.ctrlModifier=2e3,this.altModifier=4e3,this.metaModifier=8e3,this.getKeyCode=function(a){var b=c(a),d=b[0],e=b[1];return angular.forEach(d,function(a,b){var c;switch(a){case"ctrl":c=x.ctrlModifier;break;case"shift":c=x.shiftModifier;break;case"alt":c=x.altModifier;break;case"meta":c=x.metaModifier}e+=c}),e};var B=[];this.getForeignKey=function(a,b){if(!a.altKey&&!a.ctrlKey){var c=[],g=f(b),h=A[a.keyCode],i=g.modifiers;if(h){if("shift"==h)return;if(a.shiftKey&&c.push("shift"),arethusaUtil.isIncluded(d(g),h)){c.push(h);var j=c.join("-");return B.push(j),!1}if(arethusaUtil.isIncluded(c,"shift")){var k=c.indexOf("shift");c.splice(k,1),h=h.toUpperCase()}c.push(h)}var l=B.concat(c),m=e(l,i),n=g[m.join("-")];return B=[],n}};var C={},D=function(a){var b=g(a),c=C[b];c&&(o(c,a),n())},E=["INPUT","TEXTAREA","SELECT"];this.keydown=function(a){if(!arethusaUtil.isIncluded(E,a.target.tagName)&&!i(a.keyCode)){var b=g(a);C[b]&&h(b)}};var F="";this.keyup=function(a){if(!arethusaUtil.isIncluded(E,a.target.tagName)){if(i(a.keyCode)){var b=a.keyCode-48;return h(b),void(F+=b)}D(a),j()}},this.doRepeated=function(a){for(var b=parseInt(F,10)||1;b>0;b--)a()};var G={};this.onKeyPressed=function(a,b,c){var d=x.getKeyCode(a);l(d,a);var e=C[d]||[],f=new k(b,c);return e.push(f),C[d]=m(e),function(){t(C[d],f)}};var H=!1;this.stopPropagation=function(){H=!0},this.create=function(a,b,c){return new p(a,b,c)},this.initCaptures=function(a){var c=[],d=arethusaUtil.inject({},a(x),function(a,d,e){var f=x.conf(d);angular.forEach(e,function(e,g){var h=f[e.confKey]||e.defaultKey;if(angular.isDefined(h)){q(a,d,e.confKey,h);var i=x.onKeyPressed(h,function(){b.$apply(e.fn)});c.push(i)}})});return angular.equals({},d)||(b.$broadcast("keysAdded",d),c.push(r(d))),d.$destroy=s(c),d},this.mappedKeyboard=function(a,b){var c=f(a),d=u(),e=[],g=["lower","upper"];return g=b?g.reverse():g,angular.forEach(d,function(a,b){a.show=[],angular.forEach(g,function(b,d){w(c,a,b)}),e.push(a)}),e},this.activeKeys={},this.keyList={}}]),angular.module("arethusa.core").service("languageSettings",["documentStore",function(a){var b=this;this.languageSpecifics={ara:{name:"Arabic",lang:"ar",leftToRight:!1,font:"Amiri"},grc:{name:"Greek",lang:"gr",leftToRight:!0},heb:{name:"Hebrew",lang:"he",leftToRight:!1},lat:{name:"Latin",lang:"la",leftToRight:!0}},this.langNames=arethusaUtil.inject({},b.languageSpecifics,function(a,b,c){a[c.lang]=c.name});var c={};this.setFor=function(a,d){c[a]=b.languageSpecifics[d]},this.getFor=function(d){var e=c[d];if(e)return e;var f=a.store[d];if(void 0!==f){var g=f.json.treebank||f.json.book;if(g){var h=g["_xml:lang"];if(h in b.languageSpecifics){var i=b.languageSpecifics[h];return b.setFor("treebank",i),i}}}}}]),angular.module("arethusa.core").service("locator",["$location",function(a){var b,c={};this.get=function(d){return b?c[d]:a.search()[d]},this.watchUrl=function(a){b=!a},this.set=function(a,b){b?c[a]=b:angular.extend(c,a)}}]),angular.module("arethusa.core").service("navigator",["$injector","configurator","$cacheFactory","keyCapture","$rootScope","globalSettings",function(a,b,c,d,e,f){function g(a,b){return[a.author,a.work,b].join(" ")}function h(a){var b=a.lastIndexOf(":");return[a.slice(0,b),a.slice(b+1)]}function i(a,b){var c,d=h(a),e=d[0],f=d[1];c=L.get(e),c?b(g(c,f)):F.get({cite:e}).then(function(a){c=a.data,L.put(e,c),b(g(c,f))}).catch(function(){b(a)})}function j(a){return a.match(/urn:cts/)}function k(){delete J.status.citation}function l(a){J.status.citation=a}function m(){k(),J.getCitation(o(),l)}function n(a){for(var b,c=J.sentences.length-1;c>=0;c--)if(J.sentences[c].id===a){b=J.sentences[c];break}return b}function o(){var a=J.currentPosition;return J.currentSentences||(J.currentSentences=J.sentences.slice(a,a+J.chunkSize)||[]),J.currentSentences}function p(){return arethusaUtil.map(o(),"id")}function q(a){J.currentPosition=a}function r(){return(f.layout.navigator||{}).chunkSize}function s(){return r()||J.conf.chunkSize||1}function t(a){var b=J.currentPosition+a*J.chunkSize;b<0&&(b=0),J.currentPosition=b,A()}function u(){J.status.hasNext=w(),J.status.hasPrev=x()}function v(){J.currentSentences=void 0,G=void 0,J.currentChunk()}function w(){return J.currentPosition+J.chunkSize<J.sentences.length}function x(){return J.currentPosition>0}function y(){function a(a){if(0!==a)return J.sentences[a-1]}function b(a){if(a!==J.sentences.length-1)return J.sentences[a+1]}var c=o(),d=c[0],e=c[c.length-1],f=J.sentences.indexOf(d),g=J.sentences.indexOf(e);K.pre=a(f),K.post=b(g)}function z(){J.hasList=!1}function A(){var b=function(){return J.lazyState||(J.lazyState=a.get("state")),J.lazyState};J.updateId(),C(),b().replaceState(J.currentChunk())}function B(a){return e.$on(H,a)}function C(){e.$broadcast(H)}function D(a){return e.$on(I,a)}function E(){e.$broadcast(I)}var F,G,H="navigator:move",I="navigator:refresh",J=this,K={},L=c("citation",{number:100});this.getCitation=function(a,b){if(F){var c=a[0];if(c){var d=c.cite;d&&(j(d)?i(d,b):b(d))}}},this.currentSubdocs=function(){return arethusaUtil.map(o(),"subdoc")},this.sentenceToString=function(a){return arethusaUtil.inject([],a.tokens,function(a,b,c){a.push(c.string)}).join(" ")},this.addSentences=function(a){arethusaUtil.pushAll(J.sentences,a),angular.forEach(a,function(a,b){J.sentencesById[a.id]=a}),u(),v()},this.goToFirst=function(){q(0),A()},this.goTo=function(a){var b=n(a);if(b){return q(J.sentences.indexOf(b)),A(),!0}alert("No sentence with id "+a+" found")},this.goToByPosition=function(a){J.sentences.length>a&&(q(a),A())},this.goToLast=function(){q(J.sentences.length-J.chunkSize),A()},this.applyChunkMode=function(){},this.changeChunkSize=function(a){J.chunkSize!==a&&(J.chunkSize=a,A())},this.currentChunk=function(){if(!G){G={};for(var a=o(),b=0;b<a.length;b++)angular.extend(G,a[b].tokens);y()}return G},this.nextChunk=function(){w()&&t(1)},this.prevChunk=function(){x()&&t(-1)},this.markChunkChanged=function(){for(var a=o(),b=a.length-1;b>=0;b--)a[b].changed=!0},this.addToken=function(a){var b=a.sentenceId,c=a.id;J.sentencesById[b].tokens[c]=a},this.removeToken=function(a){var b=a.sentenceId,c=a.id;delete J.sentencesById[b].tokens[c]},this.list=function(){return angular.element(document.getElementById("arethusa-sentence-list"))},this.switchView=function(){function a(){return angular.element(document.getElementById("arethusa-editor"))}e.$broadcast("viewModeSwitched");var b=a(),c=J.list();J.listMode?(b.removeClass("hide"),c.addClass("hide"),J.listMode=!1):(b.addClass("hide"),c.removeClass("hide"),J.listMode=!0)},this.init=function(){J.conf=b.configurationFor("navigator"),J.chunkModes=["sentence"],J.chunkMode=J.conf.chunkMode||"sentence",J.chunkSize=s(),J.sentences=[],J.sentencesById={},J.status={context:K},q(0),F=b.provideResource("citeMapper"),J.keys=d.initCaptures(function(a){return{navigation:[a.create("nextChunk",function(){a.doRepeated(J.nextChunk)},"u"),a.create("prevChunk",function(){a.doRepeated(J.prevChunk)},"i"),a.create("list",function(){J.switchView()},"L")]}}),navigator.chunkMode="sentence",e.$on("layoutChange",function(a,b){J.changeChunkSize(s())})},this.reset=function(){q(0),J.sentences=[],J.sentencesById={},J.listMode=!1,z(),J.updateId()},this.updateId=function(){u(),v(),J.status.currentPos=J.currentPosition,J.status.currentIds=p(),m()},this.onMove=B,this.onRefresh=D,this.triggerRefreshEvent=E,e.$on("tokenChange",J.markChunkChanged),e.$on("tokenAdded",J.markChunkChanged),e.$on("tokenRemoved",J.markChunkChanged),e.$on("layoutChange",z)}]),angular.module("arethusa.core").service("notifier",["configurator","toaster","$timeout",function(a,b,c){function d(){k.conf=a.configurationFor("notifier"),k.disable=k.conf.disable,k.maxMessages=k.conf.maxMessages||15}function e(a,b,c){this.type=a,this.message=b,this.title=c,this.time=new Date}function f(a){k[a]=function(b,c,d){k.disable||k.addMessage(a,b,c,d)}}function g(a,b,c){return[a,b,c].join("||")}function h(a){return m[a]}function i(a){return function(){c.cancel(m[a])}}function j(a,b){m[a]=c(i,b,!1)}var k=this;this.messages=[];var l=["success","info","wait","warning","error"];angular.forEach(l,f);var m={};this.addMessage=function(a,c,d,f){k.messages.length===k.maxMessages&&k.messages.pop();var i=g(a,c,d);if(!h(i)){f&&j(i,f);var l=new e(a,c,d);k.messages.unshift(l),b.pop(a,d,c)}},this.toggle=function(){k.panelActive=!k.panelActive},this.init=function(){d()}}]),angular.module("arethusa.core").service("plugins",["configurator","$injector","$rootScope","$q","$timeout","dependencyLoader","notifier","translator",function(a,b,c,d,e,f,g,h){function i(b){function c(a,b){function c(a){return a.replace(/([A-Z])/g,"_$1").toLowerCase()}function d(a,b){return b?a:"arethusa."+a}function e(a){return a||"dist/"+c(f.name)+".min.js"}var f=this;this.name=d(a,b),this.files=[e(b)]}if("history"===b){var e=d.defer();return e.resolve(),e.promise}var g=a.configurationFor(b),h=new c(b,g.location);return f.load(h)}function j(a){function b(a){var b=d.defer();return a().finally(aU.resolveFn(b)),b.promise}if(angular.isArray(a))return f.load(a);var c=a.ordered,e=a.unordered,g=[];return c&&g.push(b(function(){return f.loadInOrder(c)})),e&&g.push(b(function(){return f.load(e)})),d.all(g)}function k(a){var c=a.replace(/.*?\./,"");return b.get(c)}function l(a){function b(a,b){function c(a){return Object.keys(p.loader).length===a.length}c(a)&&b.resolve()}var c=d.defer();return angular.forEach(a,function(d,e){var f,g,h=i(d);h.then(function(){g=k(d);var a=g.externalDependencies;a?f=j(a):p.loader[d]=k(d)},function(){p.loader[d]=!1}),h.finally(function(){f?f.finally(function(){p.loader[d]=k(d),b(a,c)}):b(a,c)})}),c.promise}function m(a,b){e(function(){c.$broadcast("pluginAdded",b,a)})}var n,o,p=this,q=h({"plugins.added":"added","plugins.failed":"failed","plugins.alreadyLoaded":"alreadyLoaded"});this.setActive=function(a){p.active=a},this.isActive=function(a){return p.isSelected(a)&&!a.alwaysActive},this.isSelected=function(a){return a===p.active},this.doAfter=function(a,b){o.add("after",a,b)},this.declareReady=function(a){var b="string"==typeof a?a:a.name;n[b]=!0,o.resolve("after",b)},this.get=function(a){return(p.all||{})[a]||{}},this.addPlugin=function(c,e){if(p.all[c])return void g.warning(q.alreadyLoaded({name:c}));e&&a.addPluginConf(c,e);var f,h=d.defer(),k=h.promise,l=i(c),n=function(){f=b.get(c);var a=f.externalDependencies;a?j(a).then(o,r):o()},o=function(){p.all[c]=f,p.registerPlugin(f),f.init(),m(f,c),g.success(q.added({name:c})),h.resolve(f)},r=function(){g.error(q.failed({name:c})+"!"),h.reject()};return l.then(n,r),k},this.registerPlugin=function(a,b){function c(a){return!(!a.template||a.noView)}c(a)&&(a.main?p.main.push(a):p.sub.push(a)),a.contextMenu&&p.withMenu.push(a)},this.init=function(){function a(){var b=this,c=a;this.after={},this.before={},c.prototype.resolve=function(a,c){var d=b[a][c]||[];angular.forEach(d,function(a,b){a()})},c.prototype.add=function(a,c,d){var e=b[a],f=e[c];f||(f=e[c]=[]),f.push(d),n[c]&&d()}}function b(a){angular.isFunction(a.init)&&a.init()}n={},o=new a,angular.forEach(p.all,b)},this.start=function(a){function b(a){angular.forEach(a,function(a,b){var c=p.loader[a];c&&(p.all[a]=c)})}function e(){p.main=[],p.sub=[],p.withMenu=[],angular.forEach(p.all,p.registerPlugin)}function f(){p.setActive(p.sub[0])}function g(){angular.forEach(p.all,m)}p.loaded=!1,p.loader={},p.all={};var h=d.defer();return l(a).then(function(){b(a),p.init(),e(),f(),g(),p.loader={},p.loaded=!0,c.$broadcast("pluginsLoaded"),h.resolve()}),h.promise}}]),angular.module("arethusa.core").service("relocateHandler",["$location","$window","configurator","$analytics",function(a,b,c,d){function e(b){return f[b].baseUrl+a.url()}var f=c.configurationFor("relocateHandler")||{};this.defined=!angular.equals({},f),this.locations=this.defined?Object.keys(f):[],this.relocate=function(a,c){d.eventTrack("relocate",{category:"actions",label:a}),c=c||"_self",b.open(e(a),c)}}]),angular.module("arethusa.core").service("routeChangeWatcher",["$rootScope","$window",function(a,b){a.$on("$locationChangeSuccess",function(){b.location.reload()})}]),angular.module("arethusa.core").service("saver",["configurator","notifier","keyCapture","state","$rootScope","$window","translator","$analytics","exitHandler",function(a,b,c,d,e,f,g,h,i){function j(){return w=a.configurationFor("main"),a.getPersisters(w.persisters)}function k(){var b=aU.inject({},x,function(a,b,c){angular.isFunction(c.output)&&(a[b]=c)});return angular.extend(b,a.getPersisters(w.outputters))}function l(){x=j(),z.outputters=k()}function m(){return!angular.equals({},x)}function n(){m()&&o()&&(z.canSave=!0)}function o(){return"editor"===a.mode()}function p(){z.canSave=!1}function q(a){z.needsSave=!1,e.$broadcast(y),b.success(A.success())}function r(a){406==a.status?q():b.error(A.error())}function s(a,b){a.saveData(q,r)}function t(){z.activeKeys={};var a=c.initCaptures(function(a){return{saver:[a.create("save",function(){z.save()},"ctrl-S")]}});angular.extend(z.activeKeys,a.saver)}function u(){d.on("tokenChange",v),d.on("tokenAdded",v),d.on("tokenRemoved",v)}function v(){z.needsSave=!0}var w,x,y="saveSuccess",z=this,A=g({"saver.success":"success","saver.error":"error","saver.inProgress":"inProgress","saver.nothingToSave":"nothingToSave","saver.confirmNote":"confirmNote","saver.confirmQuestion":"confirmQuestion"});this.save=function(){h.eventTrack("save",{category:"actions",label:"save"}),z.needsSave?(b.wait(A.inProgress()),angular.forEach(x,s)):b.info(A.nothingToSave())},d.debug||(f.onbeforeunload=function(a){if(z.needsSave)return A.confirmNote();i.triggerLeaveEvent()},e.$on("$locationChangeStart",function(a){z.needsSave&&(f.confirm(A.confirmNote()+"\n"+A.confirmQuestion())||a.preventDefault())}),e.$on("destroy",function(){f.onbeforeunload=void 0})),this.onSuccess=function(a){e.$on(y,a)},this.init=function(a){t(),p(),l(),n(),u()}}]),angular.module("arethusa.core").service("sidepanel",["globalSettings","$rootScope","$timeout",function(a,b,c){function d(a){return angular.element(document.getElementById(a))}function e(){h.width(h.width()-i.width()),i.show()}function f(){h.width(h.width()+i.width()),i.hide()}function g(){var b=a.layout;j.active=b.sidepanel,j.active&&(j.folded=b.folded,c(function(){h=d("main-body"),i=d("sidepanel"),j.folded&&f()}))}var h,i,j=this;this.toggle=function(){i.width(i.width()),j.folded?e():f(),j.folded=!j.folded},this.activeKeys={},b.$on("layoutChange",g),g()}]),angular.module("arethusa.core").service("spinner",function(){var a=this;this.spinning=0,this.spin=function(){a.spinning++},this.stop=function(){a.spinning--}}),angular.module("arethusa.core").service("state",["configurator","navigator","$rootScope","documentStore","keyCapture","locator","StateChange","idHandler","globalSettings","confirmationDialog","notifier","logger","DocumentResolver",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){a?(B=new m(a),B.resolve(A,o)):t()}function o(a){return function(c){b.addSentences(c),r(),D=b.currentChunk(),q(a.preselections),E(a)}}function p(){return 0===Object.keys(A).length}function q(a){var b=s();if(b){u(arethusaUtil.map(a,function(a){return h.padIdWithSId(a,b)}))}}function r(){var a=s();a&&b.goTo(a)||b.updateId()}function s(){var a=C.conf.chunkParam;if(a)return f.get(a)}function t(){if(b.reset(),C.deselectAll(),p())return void C.checkLoadStatus();angular.forEach(A,function(a,b){a.get(o(a))})}function u(a){angular.forEach(a,function(a,b){C.selectToken(a,"ctrl-click")})}function v(a,b){return"hover"===a&&"hover"!==b||!a}function w(a){var b,c=C.firstSelected(),d=Object.keys(C.tokens),e=d.indexOf(c);switch(a){case"next":b=d[e+1]||d[0];break;case"prev":b=d[e-1]||d[d.length-1]}C.deselectAll(),C.selectToken(b,"click")}function x(a){a.status||(a.status={})}function y(a,b,c,d){var e=this;this.event=a,this.exec=b,this.destroy=function(){c&&c(),d.splice(d.indexOf(e),1)}}function z(){C.conf=a.configurationFor("main"),A=a.getRetrievers(C.conf.retrievers),C.silent=!0,C.batchChange=!1,C.debug=C.conf.debug,C.initServices(),C.activeKeys={};var b=e.initCaptures(function(a){return{selections:[a.create("nextToken",function(){a.doRepeated(C.selectNextToken)},"w"),a.create("prevToken",function(){a.doRepeated(C.selectPrevToken)},"e"),a.create("deselect",C.deselectAll,"esc"),a.create("deselect-alternative",C.deselectAll,"↵")]}});angular.extend(C.activeKeys,b.selections)}var A,B,C=this;this.documents=function(){return d.store};var D={};this.retrieveDocuments=n,this.retrieveTokens=t;var E=function(a){a.loaded=!0,C.checkLoadStatus()};this.checkLoadStatus=function(){var b=!0;if(angular.forEach(A,function(a,c){b=b&&a.loaded}),b){var c=function(){C.launched=!0,C.replaceState(D,!0)};d.hasAdditionalConfs()?a.loadAdditionalConf(d.confs).finally(c):c()}},this.asString=function(a){return(C.getToken(a)||{}).string},this.getToken=function(a){return C.tokens[a]||{}},this.selectedTokens={},this.clickedTokens={},this.hasSelections=function(){return 0!==Object.keys(C.selectedTokens).length},this.hasClickSelections=function(){return Object.keys(C.clickedTokens).length},this.isSelected=function(a){return a in this.selectedTokens},this.isClicked=function(a){return a in this.clickedTokens},this.multiSelect=function(a){C.deselectAll(),u(a)};var F;this.selectToken=function(a,b){"click"===b&&C.deselectAll(),v(C.selectionType(a),b)&&(C.selectedTokens[a]=b,"hover"!==b&&(C.clickedTokens[a]=b),"click"===b&&(F=function(){C.selectedTokens[a]=C.clickedTokens[a]="ctrl-click"}),"ctrl-click"===b&&F&&(F(),F=void 0))},this.selectionType=function(a){return C.selectedTokens[a]},this.deselectToken=function(a,b){C.selectionType(a)===b&&(delete C.selectedTokens[a],delete C.clickedTokens[a])},this.toggleSelection=function(a,b){this.isSelected(a)&&this.selectionType(a)==b?this.deselectToken(a,b):this.selectToken(a,b)},this.deselectAll=function(){F=void 0;for(var a in C.selectedTokens)delete C.selectedTokens[a],delete C.clickedTokens[a]},this.firstSelected=function(){return Object.keys(C.selectedTokens)[0]},this.selectNextToken=function(){w("next")},this.selectPrevToken=function(){w("prev")},this.getPreviousTokens=function(a,b){var c=[],d=Object.keys(C.tokens),e=d.indexOf(a)-1;if(e>=0){var f=0;b&&(f=e-b+1),f<0&&(f=0);for(var g=f;g<=e;g++)c.push(C.getToken(d[g]))}return c},this.getNextTokens=function(a,b){var c=[],d=Object.keys(C.tokens),e=d.indexOf(a)+1,f=d.length-1;b&&e+b-1<f&&(f=e+b-1);for(var g=e;g<=f;g++)c.push(C.getToken(d[g]));return c},this.toTokenStrings=function(a){var b=h.nonSequentialIds(a),c=[];return angular.forEach(a,function(a,d){c.push(C.asString(a)),b[d]&&c.push("...")}),c.join(" ")},this.addToken=function(a,c){C.tokens[c]=a,x(a),b.addToken(a),C.countTotalTokens(),C.broadcast("tokenAdded",a)},this.removeToken=function(a){var c=C.getToken(a),d="Do you really want to remove "+c.string+"?";j.ask(d).then(function(){C.doBatched(function(){C.broadcast("tokenRemoved",c),delete C.tokens[a]}),b.removeToken(c),h.unassignSourceId(c),k.success(c.string+" removed!"),C.deselectAll(),C.countTotalTokens()})},this.countTotalTokens=function(){C.totalTokens=Object.keys(C.tokens).length},this.countTokens=function(a){var b=0;return angular.forEach(C.tokens,function(c,d){a(c)&&b++}),b},this.setState=function(a,b,c){l.log("state.setState is DEPRECATED. Use state.change() instead.");var d=C.tokens[a];if(d){d[b];d[b]=c}},this.unsetState=function(a,b){var c=C.tokens[a];c[b];delete c[b]},this.replaceState=function(a,b){b||C.deselectAll(),C.tokens=a,C.launched&&C.broadcast("stateLoaded")},this.setStyle=function(a,b){C.getToken(a).style=b},this.unsetStyle=function(a){C.getToken(a).style={}},this.addStyle=function(a,b){var c=C.getToken(a);c.style||(c.style={}),angular.extend(c.style,b)},this.removeStyle=function(a,b){var c=C.getToken(a).style;if(c){var d=arethusaUtil.toAry(b);angular.forEach(d,function(a,b){delete c[a]})}},this.unapplyStylings=function(){angular.forEach(C.tokens,function(a,b){C.unsetStyle(b)})},this.addStatusObjects=function(){angular.forEach(C.tokens,x)},this.lazyChange=function(a,b,c,d,e){return new g(C,a,b,c,d,e)},this.change=function(a,b,c,d,e){var f=C.lazyChange(a,b,c,d,e);return i.shouldDeselect(b)&&C.deselectAll(),f.exec()};var G={"*":[]};this.notifyWatchers=function(a){function b(b){b.exec(a.newVal,a.oldVal,a)}var c=G[a.property]||[];angular.forEach(c,b),angular.forEach(G["*"],b)},this.watch=function(a,b,c){var d=G[a];d||(d=G[a]=[]);var e=new y(a,b,c,d);return d.push(e),e.destroy},this.on=function(a,b){c.$on(a,b)},this.broadcast=function(a,b){c.$broadcast(a,b)},this.doSilent=function(a){C.silent=!0,a(),C.silent=!1},this.doBatched=function(a){C.batchChangeStart(),a(),C.batchChangeStop()},this.batchChangeStart=function(){C.batchChange=!0},this.batchChangeStop=function(){C.batchChange=!1,C.broadcast("batchChangeStop")},this.initServices=function(){b.init(),i.init()},this.init=function(){z(),n(C.conf.resolver)},this.postInit=function(){C.addStatusObjects(),C.countTotalTokens()}}]),angular.module("arethusa.core").service("userPreferences",["globalSettings","arethusaLocalStorage",function(a,b){function c(a){return f+"."+a}function d(a,d,e){b.set(c(a+"."+d),e)}function e(a,d){return b.get(c(a+"."+d))}var f="preferences";this.set=function(b,c,e){a.persistSettings&&d(b,c,e)},this.get=e}]),angular.module("arethusa.core").service("versioner",["VERSION",function(a){function b(a){return c.repository+"/tree/"+a}var c=this;angular.extend(this,a),this.commitUrl=b(a.revision),this.branchUrl=b(a.branch)}]),angular.module("arethusa.core").value("duScrollEasing",function(a){return a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1}),angular.module("arethusa.core").constant("LOCALES",["en","de","fr","hr","pt_BR","ka","bg"]),angular.module("arethusa.core").run(["$templateCache",function(a){"use strict";a.put("js/arethusa.core/templates/arethusa_grid.html",'<div gridster="grid.options">\n  <ul>\n    <li\n      gridster-item="item"\n      ng-style="item.style"\n      ng-repeat="item in grid.items track by item.plugin">\n      <arethusa-grid-handle>Handle</arethusa-grid-handle>\n      <plugin name="{{ item.plugin }}"></plugin>\n    </li>\n  </ul>\n</div>\n'),a.put("js/arethusa.core/templates/arethusa_grid_handle.html",'<div class="drag-handle-trigger">\n  <div class="drag-handle fade" ng-show="visible">\n    <div class="drag-handle">\n      <span>{{ item.plugin }}</span>\n      <span ng-show="plugin.settings" settings-trigger="right"/>\n      <div ng-if="settingsOn"\n        style="padding: .3rem 1rem; text-align: right"\n        class="fade">\n        <div\n          ng-repeat="setting in plugin.settings">\n          <div ng-if="setting.directive" dynamic-directive="{{ setting.directive }}"/>\n          <div ng-if="!setting.directive" plugin-setting/>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),a.put("js/arethusa.core/templates/arethusa_tabs.html",'<tabset class="arethusa-tabs">\n  <tab\n    ng-repeat="pl in visibleTabs"\n    select="plugins.setActive(pl)"\n    heading="{{ pl.displayName }}"\n    active="plugins.isSelected(pl)">\n    <plugin\n      name="{{ pl.name }}"\n      with-settings="true"\n      ng-if="plugins.isActive(pl)">\n    </plugin>\n  </tab>\n  <tab ng-if="showSettingsTab">\n    <tab-heading>\n      <i class="fi-widget rotate-on-hover"></i>\n    </tab-heading>\n\n    <div class="arethusa-tabs-settings-tab">\n      <p translate="tabs.helpText"></p>\n\n      <ul dnd-list="list">\n        <li ng-repeat="item in list"\n          dnd-draggable="item"\n          dnd-moved="moveTab($index, event)"\n          dnd-effect-allowed="move"\n          dnd-selected="toggleTab(item)"\n          ng-class="{ deactivated: !isActive(item) }">\n          {{ item.label }}\n        </li>\n      </ul>\n    </div>\n  </tab>\n</tabset>\n\n'),a.put("js/arethusa.core/templates/arethusa_user.html",'<span>\n  <a ng-href="{{ user.page }}" target="_blank">{{ name }}</a>\n</span>\n<span ng-if="withMail && user.mail" style="margin-left: .5rem">\n  <a ng-href="mailto:{{ user.mail }}">\n    <i class="fi-mail"></i>\n  </a>\n</span>\n'),a.put("js/arethusa.core/templates/chunk_mode_switcher.html",'<div>\n  <label>\n    <span translate="globalSettings.chunkMode"/>\n    <select\n      style="width: 8rem"\n      class="compact"\n      ng-model="navi.chunkMode"\n      ng-change="navi.applyChunkMode()"\n      ng-options="mode as mode for mode in navi.chunkModes">\n    </select>\n\n    <form ng-submit="tryToSetChunkSize()" style="display: inline-block">\n      <input\n        style="width: 2rem"\n        class="compact"\n        type="text" ng-model="size"/>\n    </form>\n  </label>\n</div>\n\n'),a.put("js/arethusa.core/templates/collected_plugin_settings.html",'<table class="plugin-settings">\n  <tr ng-repeat="plugin in plugins.all" ng-if="plugin.settings">\n    <td class="name">{{ plugin.displayName }}</td>\n    <td ng-repeat="setting in plugin.settings">\n      <span ng-if="setting.directive" dynamic-directive="{{ setting.directive }}"/>\n      <span ng-if="!setting.directive" plugin-setting/>\n    </td>\n  </tr>\n</table>\n'),a.put("js/arethusa.core/templates/colorizer_setting.html",'<label>\n  <span translate="{{ setting.label }}"/>\n  <select\n    style="width: 8rem"\n    class="compact"\n    ng-model="gS[setting.property]"\n    ng-change="gS.applyColorizer()"\n    ng-options="k as k for (k, v) in gS.colorizers">\n  </select>\n</label>\n'),a.put("js/arethusa.core/templates/confirmation_dialog.html",'<div class="center">\n  <p class="italic bold ">\n    {{ message }}\n  </p>\n  <div>\n    <span\n      ng-click="$close()"\n      class="button success success"\n      close-on-enter\n      translate="yes">\n    </span>\n    <span\n      ng-click="$dismiss()"\n      class="button success alert"\n      translate="no">\n    </span>\n  </div>\n</div>\n\n'),a.put("js/arethusa.core/templates/editors.html",'<ul ng-if="editors.editorsPresent" class="no-list">\n  <li ng-repeat="(doc, users) in editors.perDocument">\n     <strong>{{ doc }}</strong>\n     <ul class="no-list">\n       <li ng-repeat="user in users">\n          <div arethusa-user="user" with-mail="true"/>\n       </li>\n     </ul>\n  </li>\n</ul>\n\n<div ng-if="!editors.editorsPresent" translate="editors.noEditorsPresent"/>\n'),a.put("js/arethusa.core/templates/error_dialog.html",'<div class="center">\n  <p class="italic bold ">\n    {{ message }}\n  </p>\n  <p class="error-modal-sendhint" translate="errorDialog.sendHint"/>\n  <pre class="overflow-wrap-word">\n    {{ trace }}\n  </pre>\n  <div class="center">\n    <span\n      ng-click="$dismiss()"\n      class="button success alert"\n      translate="errorDialog.close">\n    </span>\n  </div>\n</div>\n\n'),a.put("js/arethusa.core/templates/foreign_keys_help.html",'<div ng-if="visible">\n  <ul id="keyboard">\n    <li ng-repeat="key in keys"\n      id="{{ key.lower }}"\n      ng-click="generate(key.lower)"\n      ng-class="key.style.class"\n      class="keyboard-key">\n      <span ng-repeat="char in key.show"\n        class="shifted-{{$index}}"\n        ng-class="key.style.class[{{$index}}]">{{ char }}</span>\n    </li>\n  </ul>\n  <div delimiter/>\n</div>\n'),a.put("js/arethusa.core/templates/global_click_action.html",'<label>\n  <span translate="{{ setting.label }}"/>\n  <select\n    style="width: 8rem"\n    class="compact"\n    ng-model="gS[setting.property]"\n    ng-change="gS.setClickAction(gS[setting.property])"\n    ng-options="k as k for (k, v) in gS.clickActions">\n  </select>\n</label>\n'),a.put("js/arethusa.core/templates/global_settings_panel.html",'<div ng-if="active" class="fade">\n  <p class="text" translate="globalSettings.title"/>\n  <div class="small-12 columns scrollable text">\n    <ul class="no-list in-columns" style="height: 240px">\n      <li\n        class="fade"\n        ng-repeat="name in gS.settings | keys"\n        ng-init="setting = gS.settings[name]">\n        <div ng-switch="setting.type">\n          <div\n            ng-switch-when="custom"\n            dynamic-directive="{{ setting.directive }}"/>\n          <div ng-switch-default>\n            <input\n              type="{{ setting.type }}"\n              ng-change="gS.propagateSetting(setting.property)"\n              ng-model="gS[setting.property]"/>\n            <label>\n              <span translate="{{ setting.label }}"/>\n            </label>\n          </div>\n        </div>\n      </li>\n    </ul>\n\n    <div\n      ng-click="togglePluginSettings()"\n      translate="globalSettings.pluginSettings"\n      class="underline clickable">\n    </div>\n\n    <div\n      class="fade"\n      ng-if="pluginSettingsVisible"\n      collected-plugin-settings>\n    </div>\n  </div>\n</div>\n'),a.put("js/arethusa.core/templates/grid_items.html",'<br/>\n<div>\n  <p class="text">\n    <span>Grid</span>\n    <span translate="items"></span>\n  </p>\n  <ul class="no-list in-columns">\n    <li ng-repeat="(name, status) in grid.itemList">\n      <input\n        style="margin-bottom: 0.3rem"\n        type="checkbox"\n        ng-change="grid.toggleItem(name)"\n        ng-model="grid.itemList[name]"/>\n      <label>\n        {{ name }}\n      </label>\n    </li>\n  </ul>\n</div>\n'),a.put("js/arethusa.core/templates/grid_setting.html",'<div style="display: inline-block">\n  <p class="text">\n    <span>Grid</span>\n    <span translate="settings"></span>\n  </p>\n  <ul class="no-list">\n    <li ng-repeat="(key, value) in settings">\n      <input\n        type="checkbox"\n        ng-model="settings[key]"/>\n      <label>\n        <span translate="grid.{{ key }}"/>\n      </label>\n    </li>\n  </ul>\n</div>\n'),a.put("js/arethusa.core/templates/help_panel.html",'<div ng-if="active" class="fade small-12-columns">\n  <div class="small-6 large-6 columns">\n    <div help-panel-item toggler="colors" heading="helpPanel.colorLegends" height="400px">\n      <ul class="no-list" ng-repeat="(name, values) in gS.colorMaps()">\n        <li\n          ng-class="{ \'active-colorizer\': name === gS.colorizer }">\n          {{ name }}\n        </li>\n        <ul class="no-list" ng-repeat="map in values.maps">\n          <li>\n            {{ map.label }}\n            <table class="small">\n              <tr>\n                <th ng-repeat="header in values.header">\n                  <strong>{{ header }}</strong>\n                </th>\n              </tr>\n              <tr ng-repeat="(k, col) in map.colors">\n                <td\n                  ng-style="col"\n                  ng-repeat="val in k.split(\' || \') track by $index">\n                  {{ val }}\n                </td>\n              </tr>\n            </table>\n          </li>\n        </ul>\n      </ul>\n    </div>\n\n    <div help-panel-item toggler="messages" heading="messages" height="200px">\n      <ul class="no-list">\n        <li ng-repeat="message in notifier.messages">\n          <div class="notification-list-item">\n            <span class="time">{{ message.time | date: "HH:mm:ss" }}</span>\n            <span class="message toast-{{ message.type }}">{{ message.message }}</span>\n          </div>\n        </li>\n      </ul>\n    </div>\n\n    <div help-panel-item toggler="editors" heading="editors.title" height="200px">\n      <div editors/>\n    </div>\n  </div>\n\n  <div class="small-6 large-6 columns">\n    <div help-panel-item toggler="keys" heading="helpPanel.keyboardShortcuts" height="400px">\n      <ul class="no-list" ng-repeat="(section, keys) in kC.activeKeys">\n        <li>{{ section }}</li>\n        <table class="small">\n          <tr ng-repeat="(name, key) in keys">\n            <td><strong>{{ key }}</strong></td><td>{{ name}}</td>\n          </tr>\n        </table>\n      </ul>\n    </div>\n\n    <div help-panel-item toggler="tools" heading="helpPanel.tools" height="50px">\n      <ul class="no-list">\n        <li ng-repeat="tool in tools">\n          <a ng-href="{{ tool.href }}">{{ tool.label }}</a>\n        </li>\n      </ul>\n    </div>\n\n    <div help-panel-item toggler="about" heading="helpPanel.about" height="160px">\n      <ul class="no-list">\n        <li>\n          <table class="small">\n            <tr>\n              <td translate="helpPanel.revision"/>\n              <td>\n                <a ng-href="{{ vers.commitUrl }}" target="_blank">\n                  {{ vers.revision }}\n                </a>\n              </td>\n            <tr>\n            <tr>\n              \x3c!--This is untranslated on purpose!--\x3e\n              <td>Branch</td>\n              <td>\n                <a ng-href="{{ vers.branchUrl }}" target="_blank">\n                  {{ vers.branch }}\n                </a>\n              </td>\n            <tr>\n            <tr>\n              <td translate="date"/>\n              <td>{{ vers.date | date: \'medium\' }}</td>\n            </tr>\n            <tr>\n              <td translate="relocateHandler.title"/>\n              <td relocate/>\n            </tr>\n          </table>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),a.put("js/arethusa.core/templates/help_panel_item.html",'<div delimiter/>\n<div class="text">\n  <div help-panel-heading toggler="{{ toggler }}" heading="{{ heading }}"/>\n  <div\n    class="small-12 columns scrollable slider"\n    style="height: {{ height }}"\n    ng-if="visible[toggler]"\n    ng-transclude>\n  </div>\n</div>\n'),a.put("js/arethusa.core/templates/help_panel_widget.html",'<div ng-if="active" class="fade small-12-columns">\n  <div class="small-12 large-12 columns">\n    <div help-panel-item toggler="editors" heading="editors.title" height="200px">\n      <div editors/>\n    </div>\n    <div help-panel-item toggler="colors" heading="helpPanel.colorLegends" height="400px">\n      <ul class="no-list" ng-repeat="(name, values) in gS.colorMaps()">\n        <li\n          ng-class="{ \'active-colorizer\': name === gS.colorizer }">\n          {{ name }}\n        </li>\n        <ul class="no-list" ng-repeat="map in values.maps">\n          <li>\n            {{ map.label }}\n            <table class="small">\n              <tr>\n                <th ng-repeat="header in values.header">\n                  <strong>{{ header }}</strong>\n                </th>\n              </tr>\n              <tr ng-repeat="(k, col) in map.colors">\n                <td\n                  ng-style="col"\n                  ng-repeat="val in k.split(\' || \') track by $index">\n                  {{ val }}\n                </td>\n              </tr>\n            </table>\n          </li>\n        </ul>\n      </ul>\n    </div>\n    <div help-panel-item toggler="about" heading="helpPanel.about" height="160px">\n      <ul class="no-list">\n        <li>\n          <table class="small">\n            <tr>\n              <td translate="helpPanel.revision"/>\n              <td>\n                <a ng-href="{{ vers.commitUrl }}" target="_blank">\n                  {{ vers.revision }}\n                </a>\n              </td>\n            <tr>\n            <tr>\n              \x3c!--This is untranslated on purpose!--\x3e\n              <td>Branch</td>\n              <td>\n                <a ng-href="{{ vers.branchUrl }}" target="_blank">\n                  {{ vers.branch }}\n                </a>\n              </td>\n            <tr>\n            <tr>\n              <td translate="date"/>\n              <td>{{ vers.date | date: \'medium\' }}</td>\n            </tr>\n            <tr>\n              <td translate="relocateHandler.title"/>\n              <td relocate/>\n            </tr>\n          </table>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n'),a.put("js/arethusa.core/templates/keys_to_screen.html",'<div id="keys-to-screen">\n  <span\n    ng-repeat="key in keys"\n    class="key-to-screen"\n    ng-class="{ joiner: key.joiner }">{{ key.str }}</span>\n  <span ng-repeat="action in actions"\n    class="text italic right action">\n      {{ action.str }}\n  </span>\n</div>\n'),a.put("js/arethusa.core/templates/layout_setting.html",'<label>\n  <span translate="{{ setting.label }}"/>\n  <select\n    style="width: 8rem"\n    class="compact"\n    ng-model="gS[setting.property]"\n    ng-change="gS.broadcastLayoutChange()"\n    ng-options="layout.name for layout in gS.layouts">\n  </select>\n</label>\n'),a.put("js/arethusa.core/templates/navbar_buttons.html",'<li><a class="button" help-trigger/></li>\n\n'),a.put("js/arethusa.core/templates/navbar_buttons_collapsed.html","<li><a help-trigger/></li>\n"),a.put("js/arethusa.core/templates/navbar_navigation.html",'<ul ng-show="showNavigation()" class="navbar-navigation">\n  \x3c!--The wrapping divs around the a elements are only there for styling - the--\x3e\n  \x3c!--foundation topbar gives them a differnet look and feel when they are wrapped.--\x3e\n  <li>\n    <div>\n      <a\n        class="nav-link"\n        title="{{ trsls.goToFirst() }}"\n        ng-click="goToFirst()"\n        ng-class="{ disabled: !navStat.hasPrev }">\n        <i class="fi-previous"></i>\n      </a>\n    </div>\n  </li>\n  <li>\n  <div>\n    <a\n      class="nav-link"\n      title="{{ trsls.goToPrev(keys) }}"\n      ng-click="prev()"\n      ng-class="{ disabled: !navStat.hasPrev }">\n      <i class="fi-arrow-left"></i>\n    </a>\n  </div>\n  </li>\n  <li>\n    <div>\n      <ul class="navigation">\n        <li>\n          <a>\n            {{ ids }}\n          </a>\n          <ul>\n            <div class="navigation-menu small-12 large-12 columns">\n              <div>\n                <form ng-submit="goTo(goToLocation)">\n                  <input class="inline" type="text" ng-model="goToLocation"/>\n                </form>\n              </div>\n              <div>\n                <a sentence-list translate="list"\n                  title="{{ trsls.list(keys) }}"/>\n              </div>\n            </div>\n          </ul>\n        </li>\n      </ul>\n    </div>\n  </li>\n  <li>\n    <div>\n      <a\n        class="nav-link"\n        title="{{ trsls.goToNext(keys) }}"\n        ng-click="next()"\n        ng-class="{ disabled: !navStat.hasNext }">\n        <i class="fi-arrow-right"></i>\n    </a>\n  </div>\n  </li>\n  <li>\n    <div>\n      <a\n        class="nav-link"\n        title="{{ trsls.goToLast() }}"\n        ng-click="goToLast()"\n        ng-class="{ disabled: !navStat.hasNext }">\n        <i class="fi-next"></i>\n      </a>\n    </div>\n  </li>\n</ul>\n'),a.put("js/arethusa.core/templates/navbar_notifier.html",'<ul ng-show="showNotifier()">\n  <span current-message/>\n</ul>\n\n'),a.put("js/arethusa.core/templates/navbar_search.html",'<ul ng-show="showSearch()">\n  <li class="has-form">\n    <div class="row collapse">\n      <div class="large-10 small-10 columns">\n        <form ng-submit="search()">\n          <input\n            type="text"\n            ng-model="query"\n            placeholder="{{ search_documents }}...">\n        </form>\n      </div>\n      <div class="large-2 small-2 columns">\n        <button class="alert button expand" ng-click="search()">\n          <i class="fi-magnifying-glass"></i>\n        </button>\n      </div>\n    </div>\n  </li>\n</ul>\n'),a.put("js/arethusa.core/templates/notifications.html","<toaster-container\n  toaster-options=\"{\n    'close-button': true,\n    'position-class': 'toast-bottom-right'\n  }\">\n</toaster-container>\n"),a.put("js/arethusa.core/templates/outputter.html",'<div class="outputter">\n  <div outputter-item ng-repeat="(name, obj) in saver.outputters"/>\n</div>\n'),a.put("js/arethusa.core/templates/outputter_item.html",'<div>\n  <span class="italic">{{ obj.identifier }}</span>\n  <span class="buttons">\n    <span\n      class="button radius micro"\n      ng-class="{ on: preview }"\n      ng-click="togglePreview()"\n      translate="preview">\n    </span>\n    <span\n      class="button radius micro"\n      ng-click="download()"\n      translate="download">\n    </span>\n  </span>\n</div>\n<div delimiter/>\n<div ng-if="preview" hljs class="preview fade" source="data()"/>\n\n'),a.put("js/arethusa.core/templates/plugin.html",'<div\n  id="{{ plugin.name }}"\n  class="fade very-slow">\n  <div ng-if="withSettings && plugin.settings" plugin-settings/>\n  <div ng-include="plugin.template"/>\n</div>\n'),a.put("js/arethusa.core/templates/plugin_setting.html",'<label ng-if="!setting.directive" class="margined-hor-tiny">\n  {{ setting.label }}\n  <input\n    type="checkbox"\n    style="margin: 0"\n    ng-change="change()"\n    ng-model="plugin[setting.model]"/>\n</label>\n'),a.put("js/arethusa.core/templates/plugin_settings.html",'<div class="small-12 columns">\n  <span settings-trigger="right"/>\n  <span ng-show="settingsOn">\n    <span ng-repeat="setting in plugin.settings" class="right">\n      <span ng-if="setting.directive" dynamic-directive="{{ setting.directive }}"/>\n      <span ng-if="!setting.directive" plugin-setting/>\n    </span>\n  </span>\n</div>\n'),a.put("js/arethusa.core/templates/relocate.html",'<ul ng-if="locations" class="no-list">\n  <li class="relocate-item clickable" ng-repeat="location in locations" ng-click="relocate(location)">\n    {{ location }}\n  </li>\n</ul>\n<div ng-if="!locations" translate="relocateHandler.noLocations"/>\n'),a.put("js/arethusa.core/templates/sentence.html",'<div\n  ng-click="goTo(id)">\n  <table class="sentence-list" ng-class="{ changed: sentence.changed }">\n    <tr class="sentence-list">\n      <td>{{ citation }} {{ id }}</td>\n      <td>{{ sentenceString }}</td>\n    </tr>\n  </table>\n</div>\n\n'),a.put("js/arethusa.core/templates/settings_trigger.html",'<span\n  class="clickable"\n  ng-click="settingsOn = !settingsOn">\n  <i class="fi-widget" style="font-size: 1.2rem"></i>\n</span>\n\n'),a.put("js/arethusa.core/templates/token_selector.html",'<dl class="sub-nav" style="display:inline-block">\n  <dt\n    style="color: #4D4D4D"\n    tooltip-popup-delay="700"\\\n    tooltip-placement="bottom"\\\n    tooltip-html-unsafe="{{ selection.tooltip }}">\n    {{ selection.label }}\n  </dt>\n  <dd ng-repeat="selector in selectors" \n      ng-class="{active: selector.isActive}">\n      <a\n        ng-click="selector.action()"\n        ng-class="selector.styleClasses"\n        tooltip-popup-delay="700"\\\n        tooltip-placement="bottom"\\\n        tooltip-html-unsafe="{{ selector.tooltip }}">\n        {{selector.label}}\n      </a>\n  </dd>\n</dl>\n'),a.put("js/arethusa.core/templates/translate_language.html",'<div class="flags {{ lang }}"/>\n')}]);
//# sourceMappingURL=arethusa.core.min.map